/* 

FUNCTIONS

1. 	loader
2. 	viz
	a. 	sanfrancisco()
	b. 	zurich()
	c. 	geneva()
3. 	popup
4.	toggles

*/



//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
var loader = { 
	queue: [],
	push: function(fn, scope, params) { 
		this.queue.push(function(){ fn.apply(scope||window, params||[]); }); 
	},
	run: function() { 
		if (this.queue.length) this.queue.shift().call(); 
	}
};



//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
var viz = {

    //----------------------------------------------------------------------------------------------------------
    sanfrancisco : function() {

	    // clean viz div
	    $("#viz").html("");

		// set variables
		var lonlat = [-122.407, 37.759];
		var width = $(window).width();
		var height = $(window).height();
		var center = {
			x: width/2,
			y: height/2
		};

		// stop id: # of stop points & avg delay
		var stopsData = {"390":[3537,2.22],"913":[543,3.95],"3008":[859,3.17],"3012":[416,4.30],"3018":[416,2.00],"3019":[337,4.10],"3026":[11,0.15],"3034":[1081,2.82],"3035":[914,1.53],"3041":[46,-0.03],"3051":[1084,3.07],"3052":[905,1.72],"3057":[1099,3.03],"3058":[910,1.55],"3070":[42,3.77],"3071":[77,1.75],"3089":[431,2.23],"3093":[1467,2.97],"3094":[127,0.25],"3095":[887,5.90],"3103":[49,2.20],"3104":[59,6.92],"3136":[44,5.17],"3137":[3304,2.60],"3141":[3163,1.72],"3144":[1208,3.05],"3161":[136,4.85],"3163":[2148,2.42],"3164":[181,4.93],"3165":[50,3.52],"3182":[107,0.30],"3183":[602,2.08],"3184":[1031,3.80],"3185":[893,0.43],"3196":[709,4.23],"3197":[702,3.05],"3203":[808,3.38],"3208":[794,3.33],"3209":[112,3.58],"3214":[2703,2.57],"3215":[3360,2.13],"3238":[831,2.28],"3244":[1348,2.82],"3245":[1370,3.82],"3247":[1416,1.87],"3254":[476,3.32],"3255":[687,2.23],"3281":[2162,2.30],"3282":[2512,3.37],"3291":[1531,2.08],"3293":[1681,3.45],"3295":[1663,1.55],"3296":[1590,3.22],"3311":[1835,6.07],"3313":[414,1.27],"3317":[1658,1.47],"3325":[738,5.15],"3326":[791,4.35],"3338":[733,3.32],"3352":[1073,2.00],"3356":[3158,3.75],"3358":[662,5.45],"3370":[2746,4.37],"3371":[1448,3.83],"3390":[1429,3.57],"3391":[1466,2.08],"3406":[384,3.13],"3410":[3503,1.90],"3411":[1179,3.78],"3435":[607,1.80],"3439":[684,4.28],"3450":[686,4.13],"3462":[676,3.05],"3463":[702,2.58],"3476":[2297,3.32],"3477":[704,3.93],"3511":[1557,3.15],"3540":[1855,1.22],"3541":[1432,3.23],"3545":[1191,1.18],"3557":[21,-0.13],"3558":[544,1.57],"3559":[1344,1.20],"3560":[609,1.33],"3576":[534,0.95],"3577":[646,2.63],"3604":[641,2.22],"3606":[542,1.28],"3608":[3253,2.02],"3611":[868,3.68],"3612":[802,4.90],"3621":[412,3.43],"3622":[318,2.05],"3629":[72,3.92],"3636":[781,1.57],"3648":[746,6.52],"3693":[878,4.18],"3695":[1397,4.20],"3696":[1129,2.23],"3703":[745,1.90],"3706":[2417,3.65],"3718":[882,1.77],"3719":[665,5.55],"3725":[1195,2.10],"3730":[915,2.07],"3731":[839,6.23],"3746":[889,1.05],"3747":[842,6.68],"3754":[1097,2.65],"3772":[3021,3.05],"3778":[703,3.82],"3779":[736,1.33],"3815":[90,-2.22],"3824":[1577,1.03],"3825":[1411,0.52],"3826":[1873,0.88],"3827":[53,0.83],"3832":[53,0.90],"3860":[1555,0.73],"3861":[56,-0.87],"3862":[118,1.32],"3867":[726,2.92],"3868":[631,3.27],"3886":[23,0.82],"3887":[50,1.02],"3890":[744,3.13],"3891":[644,2.30],"3892":[2478,1.15],"3893":[2341,1.23],"3912":[1615,8.72],"3913":[1375,6.52],"3927":[2827,2.93],"3935":[1752,4.80],"3941":[3220,2.85],"3942":[1610,0.90],"3956":[123,-1.47],"3957":[287,0.92],"3986":[69,6.62],"3995":[705,6.75],"3996":[833,2.18],"4000":[905,2.43],"4005":[113,2.13],"4008":[1684,3.40],"4015":[3554,0.80],"4017":[18,-0.40],"4026":[1725,1.50],"4027":[1730,1.60],"4028":[2014,1.22],"4087":[653,1.77],"4110":[594,1.32],"4111":[1336,3.28],"4119":[1076,4.20],"4120":[3344,2.12],"4131":[698,2.60],"4132":[802,4.35],"4148":[1642,2.53],"4155":[1549,1.12],"4202":[332,0.80],"4224":[792,2.45],"4229":[1470,3.38],"4230":[1548,2.78],"4269":[101,2.60],"4270":[68,0.72],"4277":[2918,1.25],"4278":[2292,2.72],"4279":[2306,1.62],"4295":[2749,1.25],"4296":[3011,2.43],"4314":[1398,1.90],"4315":[1387,2.00],"4326":[1434,1.73],"4327":[1421,1.88],"4341":[3799,3.55],"4347":[489,1.75],"4350":[428,-0.77],"4356":[688,2.95],"4367":[316,5.88],"4369":[231,2.47],"4386":[1056,3.30],"4387":[1092,2.60],"4394":[403,4.20],"4397":[477,3.65],"4411":[2753,2.50],"4414":[1487,2.05],"4415":[2419,2.00],"4423":[1480,1.68],"4424":[1404,1.47],"4434":[1354,2.10],"4435":[1508,1.47],"4456":[351,5.52],"4474":[801,2.15],"4475":[1011,2.88],"4476":[797,2.82],"4494":[1009,2.42],"4495":[806,2.73],"4530":[928,9.55],"4547":[1623,0.08],"4558":[703,2.97],"4564":[800,3.55],"4568":[728,1.42],"4572":[233,2.85],"4575":[403,3.10],"4580":[124,1.47],"4603":[3084,1.92],"4609":[1594,1.77],"4618":[1681,2.85],"4620":[1541,2.52],"4628":[1560,2.18],"4629":[1660,2.73],"4640":[1555,2.90],"4641":[1666,2.03],"4648":[2361,2.28],"4658":[534,2.05],"4664":[528,1.52],"4665":[433,5.68],"4677":[513,1.25],"4678":[424,5.73],"4684":[328,0.02],"4685":[393,0.33],"4687":[390,0.78],"4688":[332,1.13],"4726":[1068,6.17],"4727":[1008,7.77],"4728":[4,14.68],"4729":[2627,2.23],"4732":[1129,3.08],"4733":[1354,1.55],"4735":[299,1.07],"4748":[1217,3.47],"4749":[1412,2.08],"4755":[2826,2.32],"4756":[3050,1.80],"4757":[2760,1.87],"4758":[2777,2.13],"4759":[3008,2.07],"4768":[2730,1.77],"4776":[2344,3.07],"4777":[6,23.58],"4778":[2,21.35],"4781":[537,1.25],"4782":[1163,1.50],"4803":[1818,3.08],"4805":[1702,3.73],"4823":[2208,2.85],"4824":[277,3.65],"4826":[1209,3.77],"4843":[533,0.17],"4871":[947,5.27],"4873":[657,2.83],"4885":[1295,1.90],"4886":[2612,2.03],"4895":[896,2.02],"4898":[2,14.28],"4900":[1298,1.45],"4923":[1116,0.85],"4932":[692,1.83],"4933":[664,3.13],"4952":[1518,2.97],"4953":[1460,2.65],"4958":[1434,2.27],"4962":[746,5.92],"4963":[1469,3.65],"4968":[427,4.65],"4970":[1463,0.45],"4991":[1258,1.42],"4992":[1139,0.33],"5001":[1257,1.78],"5002":[1134,0.07],"5013":[1233,1.43],"5041":[765,3.78],"5056":[2892,3.40],"5057":[71,0.50],"5063":[342,5.62],"5064":[563,13.98],"5088":[539,14.67],"5089":[600,13.25],"5129":[629,1.78],"5130":[542,1.78],"5138":[382,3.58],"5139":[396,1.03],"5147":[818,1.63],"5156":[539,14.43],"5165":[1788,4.63],"5167":[2615,1.92],"5184":[1805,7.68],"5187":[823,2.73],"5199":[1688,9.27],"5200":[1592,5.70],"5223":[1558,5.20],"5224":[1739,9.27],"5225":[1446,5.57],"5226":[1723,2.65],"5239":[1212,10.92],"5240":[1492,5.87],"5245":[2660,2.98],"5247":[3248,3.28],"5274":[1474,3.98],"5275":[1303,2.05],"5300":[124,2.28],"5301":[134,1.13],"5309":[2155,2.80],"5331":[2807,1.42],"5334":[441,0.47],"5335":[2360,3.93],"5349":[1272,4.68],"5350":[1246,1.13],"5364":[482,10.95],"5389":[1464,3.12],"5390":[1578,2.95],"5404":[1448,2.80],"5405":[1566,2.38],"5418":[1316,6.82],"5419":[3377,5.25],"5433":[344,3.80],"5434":[1644,3.45],"5435":[1647,1.73],"5448":[1286,7.47],"5452":[619,3.50],"5471":[641,0.15],"5472":[2741,1.58],"5509":[50,2.55],"5510":[55,7.45],"5511":[1277,1.72],"5535":[1912,4.40],"5536":[1899,4.72],"5544":[1744,3.93],"5545":[1743,5.28],"5551":[2805,3.80],"5552":[2514,5.98],"5553":[840,4.90],"5565":[2766,3.32],"5566":[2531,6.42],"5571":[3334,3.30],"5572":[2628,6.17],"5574":[590,1.43],"5586":[319,5.22],"5592":[1990,4.97],"5593":[3298,3.43],"5601":[1430,3.22],"5602":[1389,5.70],"5603":[984,3.43],"5605":[693,3.27],"5619":[23,-0.40],"5620":[3142,3.65],"5621":[2793,4.93],"5631":[1788,2.72],"5633":[1354,0.52],"5641":[2958,2.85],"5642":[1504,4.38],"5643":[4986,4.37],"5648":[1511,2.43],"5650":[3454,3.12],"5656":[3554,3.70],"5657":[917,6.10],"5661":[924,8.28],"5662":[914,5.27],"5665":[525,3.47],"5667":[734,1.57],"5684":[2778,1.87],"5685":[1172,3.88],"5688":[3634,2.07],"5689":[2626,0.83],"5692":[2527,4.32],"5694":[3813,3.13],"5696":[2473,4.67],"5703":[418,2.70],"5711":[1138,2.50],"5712":[942,3.28],"5713":[890,2.53],"5728":[1965,4.62],"5764":[124,0.35],"5765":[119,1.07],"5772":[136,2.32],"5796":[866,5.02],"5817":[2965,3.12],"5818":[2963,2.93],"5828":[1581,2.63],"5852":[940,3.72],"5853":[857,2.15],"5858":[421,3.28],"5859":[1363,3.08],"5863":[2501,3.38],"5864":[1597,3.90],"5914":[331,2.72],"5922":[894,1.23],"5923":[954,4.87],"5926":[2061,2.65],"5927":[2112,3.28],"5946":[48,0.10],"5948":[1416,2.48],"5949":[1235,3.10],"5952":[48,3.32],"5953":[47,-0.63],"5997":[690,3.63],"5998":[799,3.12],"5999":[691,3.43],"6000":[802,3.20],"6010":[688,2.63],"6012":[466,0.35],"6021":[1004,1.27],"6022":[1017,1.93],"6024":[7,25.98],"6026":[1427,2.20],"6027":[1465,4.12],"6028":[724,2.65],"6029":[825,5.17],"6038":[1418,2.33],"6039":[1478,4.57],"6049":[1055,11.13],"6050":[977,15.00],"6063":[1009,8.72],"6064":[1024,14.25],"6075":[1043,11.48],"6076":[998,14.32],"6086":[1127,2.48],"6088":[867,3.25],"6089":[2117,1.82],"6092":[102,0.37],"6093":[70,-0.22],"6160":[225,1.03],"6197":[801,3.70],"6229":[619,2.60],"6263":[86,2.60],"6283":[67,4.37],"6290":[56,3.18],"6293":[1525,4.57],"6295":[1885,1.17],"6296":[1705,1.30],"6311":[1867,1.10],"6312":[1874,1.00],"6314":[1874,0.95],"6327":[865,2.10],"6329":[57,6.02],"6333":[962,2.90],"6337":[94,-2.67],"6343":[1038,1.15],"6347":[18,12.17],"6352":[2736,1.83],"6359":[1273,0.45],"6364":[2473,2.25],"6365":[1477,4.97],"6391":[44,0.30],"6414":[1078,3.40],"6415":[904,2.07],"6421":[912,3.02],"6422":[1076,2.47],"6453":[850,2.97],"6464":[760,3.45],"6465":[683,2.05],"6483":[810,3.72],"6490":[1545,2.45],"6491":[1573,1.75],"6497":[5681,1.63],"6498":[2771,3.98],"6503":[1370,8.33],"6523":[3249,2.27],"6524":[4640,1.83],"6539":[1262,2.45],"6540":[1307,4.08],"6548":[313,3.27],"6575":[1166,3.77],"6591":[1238,0.18],"6592":[1006,1.53],"6596":[3290,2.77],"6603":[1220,0.13],"6604":[1232,0.27],"6606":[1820,1.37],"6613":[2,23.33],"6618":[1341,6.35],"6619":[1392,2.18],"6640":[1355,7.20],"6641":[1368,2.30],"6642":[534,11.05],"6644":[294,4.00],"6678":[330,4.45],"6679":[340,3.85],"6684":[532,3.02],"6685":[408,-0.65],"6694":[435,2.38],"6695":[431,-0.13],"6700":[430,-1.23],"6701":[415,2.30],"6708":[125,3.95],"6724":[1031,2.52],"6725":[904,2.20],"6739":[3312,6.53],"6740":[2547,2.45],"6744":[1118,3.03],"6750":[3822,2.22],"6751":[1608,2.00],"6776":[347,2.33],"6781":[917,1.83],"6786":[1259,1.62],"6787":[1315,2.50],"6800":[48,1.52],"6801":[50,1.13],"6815":[2020,3.98],"6816":[1947,3.17],"6817":[1987,3.50],"6819":[4367,3.18],"6821":[2050,3.72],"6824":[2011,3.30],"6827":[2008,3.85],"6832":[1938,3.18],"6833":[2002,4.40],"6835":[870,1.88],"6882":[676,1.18],"6928":[290,0.33],"6932":[2822,4.82],"6968":[400,1.12],"6969":[338,4.93],"6991":[1907,6.98],"6992":[3392,5.42],"6996":[3351,7.75],"7038":[1844,2.50],"7041":[347,3.72],"7057":[507,1.28],"7058":[2473,6.90],"7065":[893,1.63],"7073":[1559,2.78],"7074":[65,2.38],"7099":[3548,3.18],"7109":[1638,2.35],"7142":[1357,2.65],"7149":[877,3.73],"7160":[23,0.57],"7165":[671,4.98],"7166":[911,5.75],"7179":[9,-4.67],"7186":[803,1.87],"7204":[647,3.05],"7211":[394,1.13],"7217":[3405,7.13],"7219":[1646,11.15],"7221":[655,1.95],"7223":[1069,1.72],"7227":[994,2.18],"7235":[6166,2.07],"7253":[401,5.38],"7264":[939,7.55],"7269":[130,-0.42],"7309":[62,1.12],"7334":[310,2.95],"7342":[729,8.90],"7347":[653,4.15],"7353":[675,4.57],"7355":[884,4.77],"7362":[771,11.25],"7364":[709,11.02],"7380":[94,6.57],"7392":[738,10.23],"7397":[776,9.85],"7398":[642,3.93],"7402":[666,4.57],"7408":[63,-0.62],"7440":[34,10.98],"7476":[135,0.63],"7499":[2324,0.93],"7518":[800,0.45],"7522":[393,1.92],"7528":[346,1.77],"7543":[852,2.22],"7558":[733,-1.05],"7562":[26,0.38],"7563":[1513,2.48],"7605":[919,0.92],"7619":[3726,2.45],"7621":[215,-0.20],"7629":[108,4.50],"7669":[289,2.48],"7671":[2355,3.42],"7676":[293,0.92]}



		// d3 geo
		var projection = d3.geo.mercator()
			.center(lonlat)  
			.scale(1950000)
			.translate([width/2, height/2]);
		var path = d3.geo.path()
			.projection(projection);
		var colorScale = ["#EAF5DA","#CFE8AC","#9FC961","#7CAD34","#64961B","#41660A"];
		var colorScaleDelay = d3.scale.linear()
			.domain([0, 15])
			.range(['#ED3A2D', '#2e0101']);
		var sizeScaleFrequency = d3.scale.linear()
			.domain([1,6000])
			.range([1,40]);
		var routeID = function(d,i) {
			return "route-" + d.properties.LINEABBR.replace(" ","-");
		};
		var routeName = function(d,i) {
			return d.properties.LINENAME;
		};
		var stopR = function(d, i) {
			var delay = stopsData[d.properties.STOPID];
			if (delay) {
				return sizeScaleFrequency(delay[0]);
			};
		};
		var fillDelay = function(d,i) {
			var delay = stopsData[d.properties.STOPID];
			if (delay) {
			    return colorScaleDelay(delay[1]);
			};
		};
		var zoom = d3.behavior.zoom()
			.translate(projection.translate())
			.scale(projection.scale())
			.scaleExtent([1250000,6000000])
			.on("zoom", function() {
				projection.translate(d3.event.translate).scale(d3.event.scale);
				group.selectAll("path").attr("d", path);
				group.selectAll("circle.stop").attr("cx", function(d) {
				    return projection(d.geometry.coordinates)[0] 
				});
				group.selectAll("circle.stop").attr("cy", function(d) {
				    return projection(d.geometry.coordinates)[1] 
				});
		});



		// initialize viz
		var group = d3.select("#viz").append("svg").attr("width",width).attr("height",height);
		group.call(zoom);



		// functions to draw tracts, routes, and stops
		var tracts = function() {
			d3.json('_js/sf-census.json', function(data) {
				group.selectAll("path.tract")
					.data(data.features)
					.enter()
					.append("path")
					.attr("d", path)
					.attr("class", "tract")
					.style("fill", function(d,i) { 
						if (d.povertyLevel <= 5) {
							return colorScale[0]
						} else if (d.povertyLevel <= 10) {
							return colorScale[1]
						} else if (d.povertyLevel <= 15) {
							return colorScale[2]
						} else if (d.povertyLevel <= 20) {
							return colorScale[3]
						} else if (d.povertyLevel <= 25) {
							return colorScale[4]
						} else {
							return colorScale[5]
						};
					})
					.attr("id-number", function(d,i) { 
						return d.properties.NAMELSAD10
					})
					.attr("race-white", function(d,i) { 
						return d.raceWhite
					})
					.attr("race-black", function(d,i) { 
						return d.raceBlack
					})
					.attr("race-native", function(d,i) { 
						return d.raceNative
					})
					.attr("race-asian", function(d,i) { 
						return d.raceAsian
					})
					.attr("race-pi", function(d,i) { 
						return d.racePI
					})
					.attr("race-other", function(d,i) { 
						return d.raceOther
					})
					.attr("race-hispanic", function(d,i) { 
						return d.raceHispanic
					})
					.attr("income", function(d,i) { 
						return d.medianIncome
					})
					.attr("poverty", function(d,i) { 
						return d.povertyLevel
					})
					.on("mouseover", function(self) {
						self = $(this);
						self.css({
							"stroke-width": "2px"
						});
						var textTitle = "<p><strong>" + self.attr("id-number") + "</strong></p>";
						var textPoverty = "<p><span class=\"poverty\">" + self.attr("poverty") + "%" + "</span> of residents live under the federal poverty line</p>";
						var textRace = "<table class=\"race\"><tr><td><span>" + self.attr("race-white") + "%" + "</span></td><td>&nbsp;identify as White</td></tr><tr><td><span>" + self.attr("race-black") + "%" + "</span></td><td>&nbsp;identify as Black or African American</td></tr><tr><td><span>" + self.attr("race-native") + "%" + "</span></td><td>&nbsp;identify as American Indian or Alaska Native</td></tr><tr><td><span>" + self.attr("race-asian") + "%" + "</span></td><td>&nbsp;identify as Asian</td></tr><tr><td><span>" + self.attr("race-pi") + "%" + "</span></td><td>&nbsp;identify as Native Hawaiian or Pacific Islander</td></tr><tr><td><span>" + self.attr("race-other") + "%" + "</span></td><td>&nbsp;identify as Other</td></tr><tr><td><span>"+ self.attr("race-hispanic") + "%" + "</span></td><td>&nbsp;identify as Hispanic or Latino (of any race)" + "</td></tr></table>";
						$("#info").show().html(textTitle + textPoverty + textRace);
					})
					.on("mouseout", function(self) {
						self = $(this);
						self.css({
							"stroke-width": 0
						});
						$("#info").hide().html("");
					});
				loader.run();
			});
		};



		var routes = function() {
			d3.json('_js/sf-routes.json', function(data) {
				group.selectAll("path.route")
					.data(data.features)
					.enter()
					.append("path")
					.attr("d", path)
					.style("fill", "none")
					.attr("class", "route")
					.attr("id", routeID)
					.attr("title", routeName);
				loader.run();
			});
		};
		var stops = function() {
			d3.json('_js/sf-stops.json', function(data) {
				group.selectAll("circle.stop")
					.data(data.features)
					.enter()
					.append("circle")
					.classed("stop", true)
					.attr({
						r: stopR,
						cx: function(d,i) { 
							return projection(d.geometry.coordinates)[0] 
						},
						cy: function(d,i) { 
							return projection(d.geometry.coordinates)[1] 
						},
						"fill": fillDelay,
						"stopid": function(d,i) { 
							return d.properties.STOPID
						},
						"intersection": function(d,i) { 
							return (d.properties.ONSTREET + " & " + d.properties.ATSTREET)
						},
						"delay": function(d,i) { 
							var delay = stopsData[d.properties.STOPID];
							if (delay) {
							    if (delay[1] < 0)	{
							    	return 0;
							    } else if (delay[1] < 1) {
							    	return 1;
							    } else {
							    	//return Math.sqrt(2*(delay^2));
							    	return delay[1];
							    }
							} else {
							    return 0;
							};
						},
					})
					.on("mouseover", function(self) {
						self = $(this);
						self.animate({
							"stroke-width": ".5px",
							"opacity": 1
						}, 100);
						var text = "";
						if (self.attr("r") <= 1) {
							var text = "<p><strong>Stop " + self.attr("stopid") + "</strong><br/><span>" + self.attr("intersection") + "</span></p><p><strong>Average Delay</strong><br/> < 1 minute</p>";
						} else {
							var text = "<p><strong>Stop " + self.attr("stopid") + "</strong><br/><span>" + self.attr("intersection") + "</span></p><p><strong>Average Delay</strong><br/> " + self.attr("delay") + " minutes</p>";
						};
						$("#info").show().html(text);
					})
					.on("mouseout", function(self) {
						self = $(this);
						self.animate({
							"stroke-width": 0,
							"opacity": .3
						}, 100);
						$("#info").hide().html("");
					})		
				loader.run();
				$("#loading").fadeOut(1000);
			});
		};



		// queue up and run the functions
		loader.push(tracts);
		loader.push(routes);
		loader.push(stops);
		loader.run();



		// zoom in & out buttons
	    $("#zoom-in").on("click", function() {
		    var newScale = projection.scale() + 500000;
		    projection.scale(newScale);
		    group.selectAll("path").attr("d", path);
		    group.selectAll("circle.stop").attr("cx", function(d) {
		        return projection(d.geometry.coordinates)[0] 
		    });
		    group.selectAll("circle.stop").attr("cy", function(d) {
		        return projection(d.geometry.coordinates)[1] 
		    });
		    // important! assigns the new scale to the zoom mouse behavior
		    var zoom = d3.behavior.zoom()
		       .translate(projection.translate())
		       .scale(newScale)
		       .scaleExtent([1250000,6000000])
		       .on("zoom", function() {
		       	projection.translate(d3.event.translate).scale(d3.event.scale);
		       	group.selectAll("path").attr("d", path);
		       	group.selectAll("circle.stop").attr("cx", function(d) {
		       	    return projection(d.geometry.coordinates)[0] 
		       	});
		       	group.selectAll("circle.stop").attr("cy", function(d) {
		       	    return projection(d.geometry.coordinates)[1] 
		       	});
		    });
		    group.call(zoom);
		});
	    $("#zoom-out").on("click", function() {
		    var newScale = projection.scale() - 500000;
		    projection.scale(newScale);
		    group.selectAll("path").attr("d", path);
		    group.selectAll("circle.stop").attr("cx", function(d) {
		        return projection(d.geometry.coordinates)[0] 
		    });
		    group.selectAll("circle.stop").attr("cy", function(d) {
		        return projection(d.geometry.coordinates)[1] 
		    });
		    // important! assigns the new scale to the zoom mouse behavior
		    var zoom = d3.behavior.zoom()
		       .translate(projection.translate())
		       .scale(newScale)
		       .scaleExtent([1250000,6000000])
		       .on("zoom", function() {
		       	projection.translate(d3.event.translate).scale(d3.event.scale);
		       	group.selectAll("path").attr("d", path);
		       	group.selectAll("circle.stop").attr("cx", function(d) {
		       	    return projection(d.geometry.coordinates)[0] 
		       	});
		       	group.selectAll("circle.stop").attr("cy", function(d) {
		       	    return projection(d.geometry.coordinates)[1] 
		       	});
		    });
		    group.call(zoom);
		});



    },



    //----------------------------------------------------------------------------------------------------------
    zurich : function() {

	    // clean viz div
	    $("#viz").html("");

		// set variables
		var lonlat = [8.57, 47.376];
		var width = $(window).width();
		var height = $(window).height();
		var center = {
			x: width/2,
			y: height/2
		};

		// stop id & avg delay
		var stopsData = {"143":[9,0.68],"309":[9,0.74],"373":[2799,0.98],"588":[2169,0.29],"623":[10,0.83],"701":[7506,0.54],"729":[13,0.91],"751":[2169,0.37],"809":[127,1.27],"832":[577,2.65],"833":[84,0.13],"891":[5,0.85],"1010":[3319,0.82],"1067":[22,0.88],"1114":[20,-1.06],"1259":[227,1.95],"1270":[5026,1.56],"1305":[8730,0.55],"1306":[3834,0.52],"1308":[5569,0.67],"1309":[10718,0.85],"1310":[4552,1.12],"1311":[10810,0.48],"1312":[3944,2.02],"1362":[7,-0.08],"1366":[692,1.11],"1370":[14,0.83],"1372":[1297,0.64],"1377":[2172,0.30],"1378":[2169,0.35],"1379":[2172,0.36],"1392":[20,0.51],"1393":[832,0.57],"1398":[9,0.56],"1405":[291,0.80],"1406":[5166,0.47],"1407":[910,0.64],"1417":[7,-0.01],"1437":[184,0.09],"1443":[3073,0.44],"1452":[2178,0.26],"1454":[2481,1.17],"1456":[985,1.07],"1475":[743,0.91],"1499":[733,1.95],"1500":[1630,0.39],"1501":[7419,1.15],"1502":[9544,0.49],"1503":[1383,1.96],"1504":[11090,0.89],"1509":[144,0.74],"1510":[656,0.42],"1511":[5139,1.62],"1517":[1062,0.49],"1518":[71,1.04],"1520":[1517,0.69],"1521":[67,1.25],"1522":[706,2.89],"1523":[1965,0.65],"1524":[667,0.72],"1525":[4252,0.46],"1526":[230,0.76],"1527":[430,1.88],"1528":[11932,0.42],"1530":[69,1.14],"1531":[5203,0.39],"1532":[3022,0.59],"1533":[923,0.70],"1534":[4021,0.78],"1535":[7857,0.67],"1536":[667,0.40],"1537":[2112,1.62],"1538":[70,0.73],"1539":[8850,0.57],"1540":[1116,0.50],"1541":[9232,0.50],"1542":[10639,0.57],"1543":[3793,0.61],"1552":[595,0.67],"1553":[592,0.70],"1557":[4850,0.89],"1565":[14264,0.49],"1571":[3032,1.48],"1574":[9994,0.56],"1580":[2349,0.86],"1581":[1065,0.31],"1596":[4026,1.52],"1598":[2105,0.32],"1628":[9,0.62],"1638":[808,1.19],"1677":[1852,0.50],"1679":[551,1.87],"1686":[14,1.07],"1687":[1077,0.28],"1692":[266,0.60],"1694":[10,0.61],"1706":[14,-0.37],"1723":[534,0.60],"1724":[707,0.67],"1729":[13,0.49],"1736":[3,-0.49],"1741":[1183,2.45],"1748":[592,0.75],"1773":[1182,2.00],"1784":[8,0.29],"1790":[10,0.49],"1797":[1860,0.51],"1809":[7,0.54],"1816":[3420,1.46],"1829":[6758,1.01],"1843":[717,0.79],"1845":[4413,0.53],"1846":[2431,0.55],"1850":[8,0.34],"1851":[931,3.70],"1852":[3188,0.47],"1854":[4282,0.49],"1869":[502,0.66],"1873":[1805,0.53],"1874":[2384,0.48],"1879":[14,-0.56],"1884":[4806,0.42],"1885":[3588,2.06],"1890":[6,0.94],"1893":[4899,0.79],"1895":[6747,0.48],"1904":[146,0.82],"1905":[8549,1.98],"1906":[6071,0.52],"1907":[1593,0.37],"1908":[4802,0.81],"1909":[648,0.61],"1911":[159,0.52],"1916":[10,0.67],"1919":[2794,0.52],"1920":[1067,0.29],"1928":[2907,0.29],"1931":[4089,0.37],"1934":[4237,0.81],"1938":[13513,0.55],"1959":[1029,0.55],"2007":[485,0.92],"2008":[8,-0.59],"2009":[384,0.88],"2010":[1231,0.49],"2011":[61,6.20],"2013":[756,0.87],"2014":[733,1.00],"2015":[744,0.91],"2016":[507,0.65],"2018":[915,1.05],"2019":[2037,0.74],"2020":[673,1.89],"2021":[711,0.65],"2022":[3428,0.49],"2023":[173,40.43],"2025":[1896,0.71],"2027":[6,-1.56],"2028":[1027,0.59],"2029":[729,0.30],"2033":[946,0.71],"2034":[1241,0.44],"2035":[6383,0.43],"2036":[1130,0.68],"2038":[647,0.58],"2039":[927,0.86],"2040":[6,-1.93],"2042":[1582,0.66],"2043":[1887,1.35],"2044":[977,0.63],"2045":[3396,0.60],"2046":[3070,1.00],"2047":[3405,0.57],"2048":[903,1.13],"2050":[484,0.88],"2052":[1726,0.68],"2053":[734,0.94],"2054":[530,-0.04],"2055":[251,1.48],"2056":[666,1.18],"2057":[515,0.78],"2059":[1052,0.81],"2060":[9746,0.64],"2061":[393,0.74],"2063":[390,0.78],"2078":[1067,0.34],"2079":[1067,0.31],"2081":[207,7.79],"2082":[1065,0.33],"2083":[4188,0.68],"2084":[5503,0.46],"2085":[3538,0.36],"2086":[3534,0.49],"2087":[3552,0.40],"2088":[5498,0.56],"2089":[3713,0.62],"2090":[1860,0.49],"2092":[1461,1.97],"2094":[551,1.05],"2096":[314,1.27],"2103":[550,1.15],"2104":[4197,0.44],"2110":[1850,0.44],"2111":[3610,0.54],"2113":[7025,1.15],"2114":[537,1.04],"2120":[176,1.89],"2121":[1845,0.47],"2137":[996,0.60],"2139":[1000,0.56],"2141":[501,0.68],"2142":[492,0.43],"2143":[490,0.49],"2144":[1326,0.55],"2145":[2502,2.10],"2146":[1379,0.61],"2158":[501,0.37],"2160":[499,0.79],"2183":[5049,0.67],"2187":[1067,0.27],"2198":[2654,0.65],"2228":[7248,0.43],"2244":[3524,0.50],"2245":[1964,0.45],"2247":[2060,0.58],"2248":[3821,0.57],"2250":[3827,0.53],"2251":[350,12.20],"2253":[1961,0.46],"2254":[124,0.08],"2256":[7257,0.51],"2257":[3085,0.39],"2258":[3566,0.82],"2260":[5387,0.86],"2262":[5531,0.83],"2274":[3576,0.73],"2275":[3714,0.56],"2276":[3035,0.63],"2287":[7570,0.49],"2289":[5602,0.45],"2290":[5625,0.45],"2292":[3565,0.81],"2293":[3588,0.75],"2294":[5611,0.41],"2295":[1846,0.45],"2298":[5611,0.49],"2299":[256,8.18],"2300":[311,4.87],"2301":[683,0.28],"2302":[7158,0.45],"2308":[1837,0.56],"2312":[1843,0.43],"2313":[3033,0.61],"2315":[3658,0.78],"2316":[4604,1.93],"2320":[265,2.94],"2324":[1132,0.69],"2326":[365,0.87],"2327":[847,1.29],"2328":[1252,0.78],"2329":[8,-0.26],"2332":[1070,0.68],"2333":[511,0.74],"2334":[514,0.65],"2336":[634,0.71],"2337":[7,-0.18],"2338":[721,0.45],"2339":[723,0.36],"2341":[1664,0.50],"2346":[387,0.67],"2350":[726,1.03],"2351":[136,0.25],"2352":[1031,0.42],"2354":[1737,0.51],"2356":[1745,0.62],"2358":[50,1.19],"2360":[852,1.27],"2361":[721,0.53],"2362":[1027,0.52],"2363":[388,0.77],"2366":[643,0.59],"2367":[1911,0.67],"2368":[1233,0.59],"2369":[507,0.61],"2370":[865,1.09],"2373":[1128,0.51],"2374":[535,0.56],"2375":[5405,0.69],"2376":[388,0.81],"2377":[135,0.49],"2378":[1230,0.57],"2379":[464,0.71],"2380":[473,0.98],"2381":[924,0.81],"2382":[1463,0.71],"2383":[2025,0.88],"2385":[205,0.50],"2386":[1037,0.42],"2387":[660,2.48],"2388":[865,1.17],"2389":[1228,0.58],"2391":[1132,0.52],"2392":[628,0.67],"2394":[718,0.58],"2396":[288,1.72],"2397":[732,0.91],"2398":[1441,0.72],"2400":[6,-1.61],"2401":[1023,0.54],"2404":[1912,0.67],"2406":[3535,0.73],"2410":[1034,0.40],"2411":[1135,0.62],"2412":[1002,0.88],"2413":[1916,0.69],"2414":[6431,0.49],"2422":[1601,0.43],"2423":[946,0.38],"2424":[947,0.42],"2425":[829,1.41],"2426":[1717,0.72],"2427":[816,0.69],"2428":[3572,0.59],"2429":[4005,0.52],"2430":[606,0.49],"2431":[1181,0.52],"2432":[769,0.66],"2433":[381,0.52],"2434":[1925,0.34],"2435":[1758,0.57],"2436":[678,0.77],"2437":[1922,0.28],"2438":[1925,0.32],"2439":[1219,1.51],"2440":[2354,0.38],"2441":[2314,0.42],"2442":[1884,0.67],"2443":[815,0.71],"2444":[1926,0.22],"2445":[930,0.63],"2446":[91,-0.96],"2447":[772,0.71],"2448":[685,0.72],"2449":[418,0.85],"2450":[3551,0.53],"2451":[2685,0.51],"2452":[1137,0.63],"2453":[4609,0.62],"2454":[8301,0.77],"2455":[947,0.72],"2456":[930,0.25],"2457":[4010,0.47],"2458":[640,0.35],"2459":[1688,0.69],"2460":[1891,0.56],"2461":[772,0.69],"2462":[1738,0.83],"2463":[1887,0.60],"2464":[585,0.22],"2465":[2683,0.48],"2466":[1710,0.73],"2467":[928,0.54],"2468":[2690,0.45],"2469":[236,0.38],"2470":[978,0.96],"2471":[1136,0.58],"2472":[928,0.31],"2473":[1923,0.39],"2474":[730,2.14],"2475":[1125,0.75],"2476":[1027,0.53],"2478":[643,0.47],"2480":[369,0.33],"2481":[941,0.72],"2482":[2532,0.91],"2483":[626,0.19],"2484":[8,-0.55],"2485":[900,1.14],"2486":[383,0.86],"2487":[1887,0.69],"2488":[3487,0.57],"2489":[1745,0.66],"2490":[308,0.68],"2491":[303,0.66],"2492":[303,0.61],"2496":[298,0.88],"2497":[9,-0.31],"2498":[134,1.38],"2499":[65,1.17],"2500":[70,0.88],"2505":[2039,0.81],"2506":[1221,0.66],"2508":[4675,0.53],"2509":[3428,0.54],"2510":[1743,0.65],"2511":[1226,0.68],"2514":[248,0.75],"2516":[503,0.80],"2518":[1126,0.74],"2520":[2012,0.83],"2524":[1926,0.35],"2525":[653,0.94],"2526":[7469,1.10],"2527":[3767,0.86],"2528":[3880,0.45],"2529":[3793,0.70],"2530":[986,0.54],"2531":[3181,0.61],"2532":[3083,1.64],"2533":[3974,0.72],"2534":[536,1.14],"2535":[5453,0.46],"2536":[1504,3.28],"2537":[988,0.44],"2538":[2661,0.62],"2539":[988,0.44],"2540":[6296,0.85],"2541":[981,0.51],"2542":[3079,0.60],"2543":[4736,0.55],"2544":[2821,0.36],"2545":[324,1.09],"2546":[3056,0.62],"2547":[1336,0.90],"2548":[920,0.83],"2549":[1192,0.47],"2550":[5534,0.71],"2551":[1224,0.67],"2552":[593,0.65],"2553":[1193,0.33],"2554":[596,0.54],"2556":[1084,0.79],"2557":[493,1.50],"2558":[610,0.68],"2559":[594,0.72],"2561":[576,0.50],"2562":[1927,0.61],"2563":[2142,0.71],"2564":[3749,0.46],"2565":[1912,1.38],"2566":[491,0.39],"2567":[1873,0.34],"2568":[878,0.78],"2569":[495,0.51],"2570":[1889,0.92],"2571":[3468,0.62],"2572":[1829,0.29],"2573":[495,0.54],"2575":[1889,0.43],"2576":[2622,0.79],"2577":[487,0.71],"2578":[1629,0.46],"2579":[2114,0.41],"2580":[4515,0.44],"2581":[497,0.45],"2582":[4681,0.80],"2583":[1090,0.73],"2584":[1915,0.69],"2585":[284,0.65],"2586":[1921,0.68],"2587":[1931,0.85],"2588":[555,0.91],"2589":[1890,0.48],"2590":[10034,0.65],"2591":[1780,0.99],"2592":[592,0.63],"2593":[431,0.73],"2594":[1862,0.49],"2595":[432,0.59],"2598":[1868,0.55],"2599":[649,1.06],"2600":[1827,0.92],"2601":[59,1.92],"2603":[2360,0.69],"2604":[684,0.95],"2605":[315,0.72],"2606":[936,1.06],"2607":[6028,0.59],"2608":[1932,0.66],"2609":[2704,0.47],"2610":[3661,0.31],"2612":[4099,0.37],"2613":[1889,0.26],"2614":[1827,0.61],"2615":[5929,0.51],"2617":[378,3.43],"2618":[1971,1.42],"2619":[2065,0.53],"2620":[1747,0.94],"2621":[1747,0.92],"2622":[1956,0.77],"2624":[575,0.47],"2625":[1215,0.64],"2626":[1481,0.81],"2627":[3548,0.70],"2628":[1644,0.63],"2629":[1862,1.04],"2630":[1888,0.46],"2631":[704,0.91],"2632":[1940,1.52],"2633":[2902,0.64],"2634":[495,0.24],"2635":[1825,0.63],"2636":[1210,0.47],"2637":[1733,1.04],"2638":[2739,0.53],"2639":[1774,0.72],"2640":[2011,0.58],"2641":[3643,0.76],"2642":[475,1.10],"2643":[1229,0.61],"2645":[1845,0.33],"2646":[1852,1.17],"2647":[356,0.76],"2648":[269,2.14],"2649":[794,1.21],"2650":[3959,0.62],"2651":[5921,0.47],"2654":[587,0.52],"2655":[620,2.93],"2656":[877,1.00],"2657":[3867,0.67],"2658":[1627,0.39],"2659":[1093,0.73],"2660":[2021,0.66],"2662":[3141,0.78],"2663":[645,1.05],"2665":[1907,1.47],"2666":[5059,0.97],"2667":[1845,0.61],"2669":[1356,0.52],"2670":[505,2.78],"2671":[3689,0.61],"2672":[495,0.59],"2673":[2969,0.58],"2674":[1214,0.70],"2675":[9,0.94],"2676":[733,0.81],"2677":[358,0.19],"2678":[1630,0.43],"2680":[5914,0.52],"2681":[134,0.48],"2682":[3075,0.46],"2683":[243,-0.02],"2684":[81,1.07],"2687":[3739,0.52],"2689":[4102,0.38],"2693":[1818,1.01],"2694":[664,0.40],"2695":[1742,0.50],"2696":[282,0.73],"2698":[589,0.53],"2699":[1355,1.86],"2700":[1131,0.58],"2701":[2765,0.45],"2702":[2124,0.41],"2705":[1844,0.33],"2707":[1206,0.39],"2709":[915,0.41],"2710":[2690,0.56],"2711":[3694,0.56],"2712":[1867,0.47],"2713":[3676,0.54],"2714":[4537,0.86],"2715":[594,0.63],"2716":[941,0.48],"2718":[1888,0.50],"2720":[594,0.62],"2721":[1849,0.18],"2722":[2041,0.65],"2723":[738,0.78],"2729":[1727,0.98],"2730":[2040,0.89],"2731":[3702,0.57],"2732":[591,1.50],"2733":[324,0.62],"2734":[1738,0.46],"2735":[566,0.46],"2737":[606,0.47],"2738":[3956,0.74],"2740":[1892,0.33],"2741":[9,0.84],"2742":[554,0.74],"2743":[832,0.44],"2744":[492,0.41],"2745":[1607,0.32],"2746":[1078,0.82],"2747":[1112,0.65],"2748":[1812,1.03],"2749":[5942,0.86],"2750":[1846,0.34],"2752":[3769,0.86],"2754":[163,0.78],"2755":[825,1.58],"2756":[3943,1.01],"2757":[164,0.06],"2758":[954,1.04],"2760":[610,0.52],"2761":[1241,0.67],"2762":[592,0.70],"2763":[2706,0.51],"2764":[320,0.72],"2765":[912,0.41],"2766":[3590,0.27],"2767":[599,0.59],"2768":[3666,0.30],"2769":[1491,0.71],"2770":[1892,0.43],"2771":[914,0.43],"2772":[1424,1.76],"2773":[1874,0.51],"2774":[3661,0.30],"2775":[1317,0.80],"2777":[2982,0.80],"2778":[1854,1.06],"2779":[1786,0.38],"2780":[899,1.09],"2781":[5151,0.79],"2782":[606,0.59],"2783":[728,0.24],"2784":[2114,0.36],"2785":[260,-0.31],"2787":[1957,0.55],"2788":[5882,1.93],"2789":[3817,0.74],"2790":[568,0.83],"2791":[1858,0.33],"2792":[1827,0.29],"2795":[530,1.02],"2796":[153,1.00],"2797":[372,0.83],"2798":[368,0.89],"2799":[3604,0.22],"2800":[374,0.57],"2801":[0,0.00],"2802":[1176,0.82],"2803":[290,2.15],"2804":[4074,0.72],"2807":[3171,0.69],"2808":[2297,0.86],"2809":[1397,1.93],"2810":[3428,1.42],"2811":[1942,0.83],"2812":[1733,0.99],"2813":[1219,0.65],"2814":[3031,0.52],"2815":[1382,2.18],"2816":[405,0.76],"2817":[1852,1.04],"2818":[1890,0.39],"2821":[1548,1.98],"2822":[76,1.08],"2823":[365,0.66],"2824":[1864,1.01],"2825":[1201,0.33],"2826":[1861,1.24],"2828":[1627,0.50],"2829":[3728,0.74],"2831":[1936,0.87],"2832":[889,0.91],"2833":[552,0.94],"2834":[1732,0.38],"2835":[401,1.86],"2836":[3164,0.75],"2837":[378,0.24],"2838":[375,0.24],"2839":[78,1.20],"2840":[1928,0.73],"2841":[2678,0.60],"2843":[1876,0.54],"2845":[6337,0.89],"2846":[697,1.00],"2847":[1867,0.57],"2848":[813,1.59],"2849":[1593,2.28],"2850":[625,0.56],"2851":[3823,0.53],"2852":[77,1.08],"2853":[1829,0.59],"2854":[3663,0.40],"2855":[132,0.54],"2856":[593,0.63],"2857":[1833,0.57],"2858":[627,0.51],"2859":[335,1.15],"2861":[1809,1.03],"2862":[1837,0.56],"2863":[594,0.65],"2864":[841,1.49],"2865":[1410,0.85],"2866":[1367,0.56],"2867":[907,0.45],"2868":[2221,0.79],"2869":[459,0.37],"2870":[3424,0.44],"2871":[4918,0.69],"2872":[551,1.00],"2891":[735,0.27],"2893":[5805,0.85],"2895":[652,0.74],"2906":[1229,0.45],"2944":[8,-0.64]}



		// d3 geo
		var projection = d3.geo.mercator()
			.center(lonlat)  
			.scale(1350000)
			.translate([width/2, height/2]);
		var path = d3.geo.path()
			.projection(projection);
		var colorScale = ["#EAF5DA","#CFE8AC","#9FC961","#7CAD34","#64961B","#41660A"];
		var colorScaleDelay = d3.scale.linear()
			.domain([0, 3])
			.range(['#ED3A2D', '#2e0101']);
		var sizeScaleFrequency = d3.scale.linear()
			.domain([1,15000])
			.range([1,40]);
		var routeID = function(d,i) {
			return "route route-" + d.properties.LineEFA;
		};
		var routeName = function(d,i) {
			return d.properties.LineEFA;
		};
		var stopR = function(d, i) {
			var delay = stopsData[d.properties.stopId];
			if (delay) {
				return sizeScaleFrequency(delay[0]);
			};
		};
		var fillDelay = function(d,i) {
			var delay = stopsData[d.properties.stopId];
			if (delay) {
			    return colorScaleDelay(delay[1]);
			};
		};
		var zoom = d3.behavior.zoom()
			.translate(projection.translate())
			.scale(projection.scale())
			.scaleExtent([900000,5500000])
			.on("zoom", function() {
				projection.translate(d3.event.translate).scale(d3.event.scale);
				group.selectAll("path").attr("d", path);
				group.selectAll("circle.stop").attr("cx", function(d) {
				    return projection(d.geometry.coordinates)[0] 
				});
				group.selectAll("circle.stop").attr("cy", function(d) {
				    return projection(d.geometry.coordinates)[1] 
				});
		});



		// initialize viz
		var group = d3.select("#viz").append("svg").attr("width",width).attr("height",height);
		group.call(zoom);



		// functions to draw tracts, routes, and stops
		var tracts = function() {
			d3.json('_js/zurich-city-limit.json', function(data) {
				group.selectAll("path.tract")
					.data(data.features)
					.enter()
					.append("path")
					.attr("d", path)
					.attr("class", "tract")
					.style("fill", function(d,i) { 
						if (d.properties.MedInc <= 40) {
							return colorScale[5]
						} else if (d.properties.MedInc <= 45) {
							return colorScale[4]
						} else if (d.properties.MedInc <= 50) {
							return colorScale[3]
						} else if (d.properties.MedInc <= 55) {
							return colorScale[2]
						} else if (d.properties.MedInc <= 60) {
							return colorScale[1]
						} else {
							return colorScale[0]
						};
					})
					.attr("id-number", function(d,i) { 
						return ("quartiere-" + d.properties.QNr)
					})
					.attr("name", function(d,i) { 
						return d.properties.Qname
					})
					.attr("income", function(d,i) { 
						return d.properties.MedInc * 1000
					})
					.on("mouseover", function(self) {
						self = $(this);
						self.css({
							"stroke-width": "2px"
						});
						var text = "<p><strong>Quartiere " + self.attr("id-number").replace("quartiere-","") + " (" + self.attr("name") + ")</strong><br/>Median Income: &euro;" + self.attr("income") + "</p>";
						$("#info").show().html(text);
					})
					.on("mouseout", function(self) {
						self = $(this);
						self.css({
							"stroke-width": 0
						});
						$("#info").hide().html("");
					});
				loader.run();
			});
		};
		var routes = function() {
			d3.json('_js/zurich-routes.json', function(data) {
				//var newGroup = "g#route-" + data.features[0].properties.LineEFA;
				group.selectAll("path.route")
					.data(data.features)
					.enter()
					.append("path")
					.attr("d", path)
					.style("fill", "none")
					.attr("class", routeID)
					.attr("title", routeName);
				loader.run();
			});
		};
		var stops = function() {
			d3.json('_js/zurich-stops.json', function(data) {
				group.selectAll("circle.stop")
					.data(data.features)
					.enter()
					.append("circle")
					.classed("stop", true)
					.attr({
						r: stopR,
						cx: function(d,i) { 
							return projection(d.geometry.coordinates)[0] 
						},
						cy: function(d,i) { 
							return projection(d.geometry.coordinates)[1] 
						},
						"fill": fillDelay,
						"stopid": function(d,i) { 
							return d.properties.stopId
						},
						"intersection": function(d,i) { 
							return (d.properties.stopName)
						},
						"delay": function(d,i) { 
							var delay = stopsData[d.properties.stopId];
							if (delay) {
							    if (delay[1] < 0)	{
							    	return 0;
							    } else {
							    	return delay[1];
							    }
							} else {
							    return 0;
							};
						}
					})
					.on("mouseover", function(self) {
						self = $(this);
						self.animate({
							"stroke-width": ".5px",
							"opacity": 1
						}, 100);
						var text = "";
						if (self.attr("r") <= 2) {
							var text = "<p><strong>Stop " + self.attr("stopid") + "</strong><br/><span>" + self.attr("intersection") + "</span></p><p><strong>Average Delay</strong><br/> < 1 minute</p>";
						} else {
							var text = "<p><strong>Stop " + self.attr("stopid") + "</strong><br/><span>" + self.attr("intersection") + "</span></p><p><strong>Average Delay</strong><br/> " + self.attr("delay") + " minutes</p>";
						};
						$("#info").show().html(text);
					})
					.on("mouseout", function(self) {
						self = $(this);
						self.animate({
							"stroke-width": 0,
							"opacity": .3
						}, 100);
						$("#info").hide().html("");
					});
				loader.run();
				$("#loading").fadeOut(1000);
			});
		};



		// queue up and run the functions
		loader.push(tracts);
		loader.push(routes);
		loader.push(stops);
		loader.run();



		// zoom in & out buttons
	    $("#zoom-in").on("click", function() {
		    var newScale = projection.scale() + 500000;
		    projection.scale(newScale);
		    group.selectAll("path").attr("d", path);
		    group.selectAll("circle.stop").attr("cx", function(d) {
		        return projection(d.geometry.coordinates)[0] 
		    });
		    group.selectAll("circle.stop").attr("cy", function(d) {
		        return projection(d.geometry.coordinates)[1] 
		    });
		    // important! assigns the new scale to the zoom mouse behavior
		    var zoom = d3.behavior.zoom()
		       .translate(projection.translate())
		       .scale(newScale)
		       .scaleExtent([1250000,6000000])
		       .on("zoom", function() {
		       	projection.translate(d3.event.translate).scale(d3.event.scale);
		       	group.selectAll("path").attr("d", path);
		       	group.selectAll("circle.stop").attr("cx", function(d) {
		       	    return projection(d.geometry.coordinates)[0] 
		       	});
		       	group.selectAll("circle.stop").attr("cy", function(d) {
		       	    return projection(d.geometry.coordinates)[1] 
		       	});
		    });
		    group.call(zoom);
		});
	    $("#zoom-out").on("click", function() {
		    var newScale = projection.scale() - 500000;
		    projection.scale(newScale);
		    group.selectAll("path").attr("d", path);
		    group.selectAll("circle.stop").attr("cx", function(d) {
		        return projection(d.geometry.coordinates)[0] 
		    });
		    group.selectAll("circle.stop").attr("cy", function(d) {
		        return projection(d.geometry.coordinates)[1] 
		    });
		    // important! assigns the new scale to the zoom mouse behavior
		    var zoom = d3.behavior.zoom()
		       .translate(projection.translate())
		       .scale(newScale)
		       .scaleExtent([1250000,6000000])
		       .on("zoom", function() {
		       	projection.translate(d3.event.translate).scale(d3.event.scale);
		       	group.selectAll("path").attr("d", path);
		       	group.selectAll("circle.stop").attr("cx", function(d) {
		       	    return projection(d.geometry.coordinates)[0] 
		       	});
		       	group.selectAll("circle.stop").attr("cy", function(d) {
		       	    return projection(d.geometry.coordinates)[1] 
		       	});
		    });
		    group.call(zoom);
		});



    },



    //----------------------------------------------------------------------------------------------------------
    geneva : function() {

	    // clean viz div
	    $("#viz").html("");

		// set variables
		var lonlat = [6.18, 46.20];
		var width = $(window).width();
		var height = $(window).height();
		var center = {
			x: width/2,
			y: height/2
		};

		// stop id & avg delay
		var stopsData = {"35124":[222,1.70],"39872":[251,1.17],"_BSDNF":[60,1.20],"_BSDNS":[55,1.02],"_CANDF":[132,1.87],"_CANDS":[130,0.79],"_CYDNF":[55,2.12],"_CYDNS":[60,0.21],"_DOANF":[17,2.94],"_DOANS":[291,1.16],"_MOILF":[2,6.98],"_PEDOF":[753,1.89],"_PEDOS":[715,1.29],"22CT01":[2682,1.34],"31DC00":[1735,0.50],"31DC01":[1714,3.13],"AAIN00":[487,1.64],"AAIN01":[475,2.30],"AAIN02":[204,1.42],"AAIN03":[204,1.96],"ABBA00":[274,1.38],"ABBA01":[260,0.87],"ACAC00":[1101,0.89],"ACAC01":[1102,0.52],"ACIA01":[1,3.00],"ADOU00":[130,0.72],"ADOU01":[135,1.58],"AERO00":[1811,1.65],"AERO01":[1015,1.07],"AERO02":[924,0.93],"AERO03":[42,3.23],"AERO05":[463,1.52],"AERO10":[1483,1.03],"AFER00":[268,1.63],"AFER01":[277,1.83],"AGAZ00":[853,0.58],"AGAZ01":[599,1.53],"AGLA00":[130,0.76],"AGLA01":[135,1.51],"AGVR00":[262,0.84],"AIRE00":[1098,2.81],"AIRE01":[1293,0.89],"AIRE02":[204,0.83],"AIVI00":[19,1.07],"AIVI01":[21,0.82],"AJEN00":[262,2.20],"AJEN01":[273,0.76],"AJUR00":[511,2.73],"AJUR01":[506,1.62],"AJUR02":[123,2.37],"AJUR03":[127,2.03],"ALCH00":[255,1.22],"ALCH01":[244,1.24],"ALEC00":[271,1.30],"ALEC01":[277,1.18],"ALPE00":[970,0.43],"ALVI00":[336,1.55],"ALVI01":[341,1.01],"AMAR00":[253,1.34],"AMAR01":[244,1.27],"AMDO00":[1761,1.48],"AMDO01":[1751,0.81],"AMDO02":[570,1.75],"AMDO03":[571,1.44],"ANCI00":[1730,0.90],"ANCI01":[1725,1.25],"ANDO00":[368,2.08],"ANDO01":[353,1.32],"ANGA01":[2,11.09],"ANMA00":[59,0.37],"ANMA01":[59,2.09],"ANRS00":[393,1.42],"ANRS01":[395,0.46],"APIA00":[1331,1.00],"APIA01":[1338,1.23],"APIA02":[344,2.04],"APIA03":[335,1.26],"APIA05":[347,0.76],"ARAN00":[145,2.49],"ARAN01":[140,0.99],"ARAR00":[754,1.52],"ARAR01":[721,1.32],"AREN00":[1371,1.74],"AREN01":[1370,1.32],"ARME00":[1734,1.04],"ARME01":[1725,1.29],"ARME02":[1297,1.03],"ATEC00":[270,1.79],"ATEC01":[277,0.90],"ATHE00":[1043,0.81],"ATHE01":[977,0.93],"ATHE03":[602,1.51],"ATHE04":[666,0.66],"ATTV00":[191,0.90],"ATTV01":[182,1.20],"ATVI00":[270,1.66],"ATVI01":[277,1.07],"AUBI00":[1981,0.61],"AUBI01":[1293,2.67],"AUGS00":[1921,1.11],"AUGS01":[1911,1.27],"AUGSST":[1,0.00],"AUMO00":[274,1.39],"AUMO01":[260,0.75],"AVAN00":[1795,2.57],"AVAN01":[1795,0.54],"AVIA00":[755,1.39],"AVIA01":[720,1.82],"AVSY00":[541,1.21],"BADO00":[149,1.46],"BADO01":[149,0.42],"BAIR00":[4132,1.57],"BAIR01":[1220,1.89],"BAIR02":[2331,1.03],"BAIR04":[4939,1.54],"BAIR05":[4849,1.26],"BAIR06":[1771,1.17],"BAIR07":[1466,1.27],"BALE00":[193,1.08],"BALX00":[1797,2.49],"BALX01":[1795,0.61],"BANS00":[1243,0.58],"BARD00":[854,0.76],"BARD01":[844,1.95],"BASL00":[274,1.26],"BASL01":[260,0.99],"BAUD00":[905,1.90],"BAUD01":[903,0.70],"BAUD02":[2,1.20],"BAUM00":[221,2.59],"BAUM01":[220,0.80],"BCRE00":[1045,2.43],"BCRE01":[1051,0.92],"BDOU00":[67,0.92],"BELC00":[265,2.11],"BELC99":[266,1.05],"BELL00":[393,1.74],"BELL01":[396,0.50],"BESS00":[222,2.05],"BESS01":[251,1.31],"BGOU00":[429,1.41],"BGOU01":[445,0.98],"BGRI00":[478,1.75],"BGRI01":[480,0.94],"BHET00":[1187,0.68],"BHET01":[1159,1.37],"BHET04":[1813,2.42],"BHET05":[1819,1.24],"BHET06":[2,1.77],"BISE00":[394,2.29],"BISE01":[396,0.43],"BIT00,":[331,1.25],"BIT01,":[338,1.05],"BLAN00":[1735,1.23],"BLAN01":[1724,1.17],"BLBO00":[123,2.14],"BLBO01":[123,0.43],"BLCH00":[269,1.45],"BLDO00":[1794,2.65],"BLDO01":[1413,1.11],"BLDO02":[1440,1.40],"BLDO03":[1792,0.55],"BLDO04":[4,0.00],"BLHE00":[193,1.16],"BLHE01":[182,0.65],"BLID00":[249,0.67],"BLID01":[253,0.85],"BLOC00":[454,0.73],"BLOC01":[462,1.02],"BLOE01":[1,3.48],"BLTE00":[701,1.05],"BLTE01":[686,1.99],"BMON00":[573,2.17],"BMON01":[1305,1.09],"BMON02":[719,1.66],"BNDL00":[1752,1.57],"BNDL01":[1768,0.58],"BOCA00":[394,1.93],"BOCA01":[397,0.47],"BOCH00":[114,1.08],"BOGA00":[368,1.51],"BOGA01":[290,1.30],"BOHT00":[952,2.06],"BOHT01":[1795,2.51],"BOHT02":[1795,0.60],"BOHT03":[746,0.52],"BOHT04":[687,1.04],"BOHT05":[475,2.81],"BOHT06":[371,0.86],"BOIS00":[701,1.00],"BOIS01":[686,1.92],"BOLA00":[588,2.22],"BOLA01":[587,0.24],"BOLX00":[308,0.67],"BOLX01":[303,1.80],"BOND00":[244,2.15],"BOND01":[245,0.83],"BOQU00":[194,2.40],"BOQU01":[194,0.78],"BORN00":[274,1.36],"BORN01":[260,0.86],"BOSY00":[296,1.32],"BOSY01":[60,1.54],"BOUV00":[336,0.90],"BOUV01":[342,1.76],"BOVE00":[67,0.97],"BRDX00":[299,0.91],"BRET00":[130,0.79],"BRET01":[135,1.49],"BRUN00":[515,2.18],"BRUN01":[505,2.07],"BSOL00":[572,1.79],"BSOL01":[573,1.23],"BSOU00":[67,0.83],"BSSN00":[1520,0.83],"BSSN01":[942,2.17],"BSSY00":[59,0.35],"BSSY01":[59,1.92],"BSUS00":[67,0.79],"BTAI00":[463,1.09],"BTIQ00":[76,1.16],"BTIQ01":[71,2.05],"BTNI00":[1102,1.05],"BTNI01":[1097,0.28],"BUTN00":[1111,2.99],"BUTN01":[627,0.91],"BUTN02":[461,0.82],"BVRD00":[221,2.10],"BVRD01":[251,0.94],"BVYL00":[1039,1.34],"BXEG00":[1361,1.41],"BXEG01":[1376,1.59],"BXMA00":[1361,1.39],"BXMA01":[1375,1.66],"BXPL00":[1361,1.40],"BXPL02":[1648,1.59],"BXPL03":[282,1.08],"BXSA00":[1189,0.81],"BXSA01":[781,2.27],"BXSA02":[767,1.10],"CAAM00":[229,1.98],"CAAM01":[255,1.09],"CABO00":[265,1.89],"CABO01":[268,0.40],"CADO00":[274,1.31],"CADO01":[260,0.92],"CALA00":[1040,1.06],"CALA01":[2018,0.94],"CAMP00":[204,1.09],"CAMP01":[204,1.39],"CAND00":[130,0.77],"CAND01":[135,2.09],"CANI00":[60,0.35],"CANO00":[849,0.95],"CANO01":[864,0.82],"CAPI00":[222,2.07],"CAPI01":[311,0.91],"CAPI02":[0,0.00],"CARO00":[344,1.52],"CARO01":[336,1.30],"CASI00":[69,2.50],"CASI01":[69,1.72],"CAST00":[1235,0.93],"CAST01":[1245,2.02],"CBAC00":[948,1.03],"CBAC01":[942,2.24],"CBAC02":[1246,3.04],"CBAC03":[1244,0.53],"CBET00":[229,2.52],"CBET01":[223,0.74],"CBFO00":[344,1.36],"CBFO01":[336,1.43],"CBOI00":[193,2.44],"CBOI01":[194,0.58],"CBPL00":[343,1.19],"CBPL01":[336,1.66],"CBRI00":[946,1.65],"CBRI01":[970,0.24],"CCAP00":[222,2.27],"CCAP01":[251,0.90],"CCAR00":[221,3.70],"CCAR01":[220,0.79],"CCHA00":[1866,0.84],"CCHA01":[571,1.79],"CCHA02":[575,1.54],"CCLA00":[1309,1.79],"CCLA01":[1289,0.95],"CCOL00":[222,2.27],"CCOL01":[245,2.27],"CCOL02":[496,1.55],"CCVT00":[274,0.83],"CCVT01":[281,1.95],"CDOL02":[265,0.96],"CDOL03":[263,0.49],"CEAU00":[271,1.31],"CEAU01":[277,0.79],"CEBE00":[302,2.15],"CEBE01":[308,1.09],"CEGA00":[2,0.43],"CELI00":[2,0.77],"CENT00":[850,1.72],"CENT01":[872,0.83],"CEPR00":[1240,0.77],"CEPR01":[1251,2.20],"CERN00":[751,1.73],"CERN01":[522,0.31],"CERN02":[162,2.18],"CERV00":[69,2.55],"CERV01":[69,1.36],"CETX00":[442,1.91],"CETX01":[442,1.02],"CFIL00":[848,1.70],"CFIL01":[872,0.77],"CFLO00":[865,1.33],"CFLO01":[870,0.66],"CFOU00":[222,2.29],"CFOU01":[251,1.37],"CFRE00":[519,1.41],"CFRE01":[495,1.36],"CFUS00":[160,2.03],"CFUS01":[160,1.10],"CGNY00":[244,2.05],"CGNY01":[245,0.77],"CHAR00":[150,1.42],"CHAR01":[149,0.52],"CHCL00":[1581,1.45],"CHCL01":[1581,1.20],"CHCO00":[513,1.65],"CHCO01":[506,2.45],"CHGI00":[3,0.19],"CHLA00":[1972,1.30],"CHLA01":[1960,1.53],"CHLX00":[478,1.54],"CHLX01":[480,1.37],"CHNE00":[1757,1.25],"CHNE01":[1753,1.05],"CHNE02":[234,1.83],"CHNE03":[232,1.18],"CHOR00":[273,1.38],"CHOR01":[260,0.86],"CHPA00":[906,1.87],"CHPA01":[905,0.82],"CHRM00":[2023,1.66],"CHRM01":[2025,0.95],"CHRM02":[730,1.29],"CHRM03":[722,0.81],"CHTE00":[134,1.02],"CHTE01":[135,1.19],"CHTS00":[236,1.31],"CHTS01":[231,1.12],"CHVA00":[393,1.37],"CHVA01":[396,0.47],"CHVO00":[172,3.40],"CHVO01":[158,1.27],"CHVR00":[478,1.70],"CHVR01":[484,0.91],"CIMT00":[1246,2.54],"CIMT01":[1244,0.75],"CIPO00":[393,1.57],"CIPO01":[394,0.47],"CIRQ00":[981,1.19],"CIRQ01":[2051,1.12],"CIRQ02":[1152,0.40],"CIRQ03":[1615,2.25],"CIRQ04":[1576,0.66],"CIVI00":[599,1.78],"CLAP00":[1552,1.24],"CLAP01":[1040,0.54],"CLAP02":[1045,1.03],"CLDR00":[865,1.20],"CLDR01":[874,0.85],"CLFL01":[1,3.55],"CLGE00":[393,1.79],"CLGE01":[396,0.48],"CLIG00":[2139,2.36],"CLIG01":[2138,1.19],"CLIG02":[473,0.66],"CLJO00":[130,0.70],"CLJO01":[135,1.61],"CLLY00":[69,0.78],"CLOS00":[270,1.24],"CLOS01":[277,1.97],"CLYS00":[348,1.85],"CLYS01":[336,0.99],"CMAR00":[1287,2.79],"CMAR01":[1292,0.98],"CMOL00":[1242,0.83],"CMOL01":[1251,2.25],"CMRE00":[870,1.83],"CMRE01":[905,1.45],"CNAE00":[241,1.51],"CNAE01":[234,1.35],"CNDA01":[1,2.32],"COCH00":[874,0.91],"COCH01":[865,1.15],"COCU00":[232,1.13],"COCU01":[234,1.53],"CODN00":[1038,0.58],"CODN01":[1042,2.29],"COET00":[2,0.81],"COGA00":[2,0.89],"COLO00":[348,1.48],"COLO01":[244,1.00],"COLO02":[232,1.09],"COLX00":[130,0.56],"COLX01":[136,2.07],"COMU00":[3,0.93],"CONF00":[273,0.77],"CONF01":[281,2.04],"COPS00":[149,1.18],"COPS01":[149,0.57],"CORB00":[192,1.02],"CORB01":[182,1.23],"CORD00":[1286,2.95],"CORD01":[1291,0.97],"COSO00":[59,0.31],"COSO01":[59,2.23],"COTR00":[1163,1.19],"COTR01":[1196,1.46],"COUT00":[3489,1.14],"COUT01":[3485,1.27],"COUT02":[1808,1.29],"COUT03":[1216,1.78],"COVI00":[40,1.16],"CPAR00":[68,0.54],"CPBL00":[3,0.09],"CPLT00":[2149,1.68],"CPOI00":[27,1.60],"CRAN00":[2,0.17],"CRBS00":[393,1.41],"CRBS01":[396,0.46],"CRCH00":[269,1.80],"CRCH01":[277,0.69],"CRCO00":[1750,1.38],"CRCO01":[1764,0.87],"CRCO02":[273,1.66],"CRCO03":[282,1.00],"CRCO04":[454,2.26],"CRCO05":[1189,0.99],"CREN00":[406,1.20],"CRGE00":[1129,0.87],"CRGE01":[1784,1.71],"CRGE02":[643,2.73],"CRGE03":[2,1.68],"CRGE04":[884,1.20],"CRGE06":[1165,1.47],"CRIG00":[698,1.15],"CRIG01":[686,1.47],"CRIN00":[12,0.04],"CRIN01":[12,1.12],"CRNR00":[274,1.38],"CRNR01":[260,0.80],"CROI00":[1581,1.44],"CROI01":[1582,1.17],"CRRY00":[68,0.68],"CRSY00":[1156,0.83],"CRTE00":[244,1.93],"CRTE01":[248,0.77],"CRTE02":[234,1.76],"CRTE03":[232,0.98],"CRUP00":[264,1.62],"CSLB01":[490,1.29],"CSSM00":[233,1.10],"CSSM01":[274,0.93],"CSSM02":[260,2.21],"CSSM03":[232,1.75],"CTGY00":[271,1.45],"CTGY01":[277,0.78],"CTIL00":[266,2.71],"CTIL01":[265,1.29],"CTMI00":[1851,1.13],"CTMI01":[865,1.13],"CTNT00":[228,2.53],"CTNT01":[507,1.79],"CTRS00":[123,1.98],"CTRS01":[123,0.75],"CUIS00":[1735,0.53],"CUIS01":[1715,3.07],"CVER00":[229,2.90],"CVER01":[223,0.56],"CVIN01":[1917,1.17],"CVIN04":[1796,2.22],"CVIN05":[4,0.10],"CVIN06":[1042,1.55],"CVIN07":[1913,1.70],"CVIN10":[1799,0.82],"CVIN14":[2053,1.13],"CVIN15":[2070,0.70],"CVIN16":[658,2.25],"CVIN21":[687,2.05],"CVIN22":[658,1.62],"CVIN98":[18,1.53],"CVRN00":[59,0.30],"CVRN01":[59,2.13],"CVUE00":[1245,2.49],"CVUE01":[1244,0.69],"CXAB01":[1,2.60],"CXCE00":[177,1.49],"CXCE01":[176,0.88],"CXEC00":[178,2.03],"CXEC01":[176,0.58],"CYDN00":[336,1.92],"CYDN01":[342,0.39],"CYMA00":[222,2.23],"CYMA01":[251,1.30],"CYNT98":[188,2.63],"CYNT99":[174,1.98],"CYPR00":[274,0.91],"CYPR01":[260,1.83],"CYRA00":[336,1.13],"CYRA01":[342,1.44],"CYTE00":[222,2.28],"CYTE01":[251,1.48],"CYUS00":[336,0.96],"CYUS01":[341,1.35],"CYVI00":[336,1.49],"CYVI01":[342,1.00],"CZDN00":[225,0.47],"CZDN01":[226,4.01],"CZPL00":[227,3.65],"CZPL01":[221,1.16],"DARD00":[157,1.74],"DB00,6":[1.62],"DEFO00":[2,11.37],"DEHA00":[255,0.90],"DEHA01":[249,0.77],"DELC00":[1286,1.64],"DELC01":[1370,1.97],"DELC02":[722,1.03],"DELC03":[651,2.06],"DODE00":[1750,1.33],"DODE01":[1764,0.77],"DOLE00":[2019,1.73],"DOLE01":[2025,0.61],"DRIZ00":[221,2.97],"DRIZ01":[220,0.88],"DSTA00":[66,0.88],"DSTA01":[66,2.00],"DWES00":[232,1.11],"DWES01":[234,1.54],"EAUM00":[271,1.25],"EAUM01":[278,0.87],"ECOG00":[247,1.42],"ECOG01":[244,1.12],"ECU00,":[04,1.53],"ECU01,":[04,1.41],"EDVA00":[843,1.42],"EDVA01":[842,0.59],"EMED00":[981,1.09],"ENVE00":[254,1.45],"ENVE01":[244,1.16],"EPIN02":[730,1.31],"EPIN03":[722,1.16],"ERMT00":[1757,1.17],"ERMT01":[1752,0.96],"ESIN00":[2,0.00],"ESRT00":[1753,1.83],"ESRT01":[1768,0.63],"ESRT03":[1524,1.17],"ESRT04":[943,1.65],"ESRT05":[575,1.79],"ESSE00":[76,1.33],"ESSE01":[71,1.62],"ETOI00":[1587,1.42],"ETOI01":[1558,1.92],"ETOI02":[1101,0.82],"ETOI03":[1101,0.55],"EVAU00":[1237,2.84],"EVAU01":[1231,0.70],"EVOR00":[227,3.32],"EVOR01":[220,1.00],"FALQ00":[244,2.34],"FALQ01":[245,1.18],"FATI00":[661,1.88],"FAVR00":[1759,1.50],"FAVR01":[1752,0.60],"FAVR02":[254,0.90],"FAVR03":[249,0.98],"FAYA00":[245,1.40],"FAYA01":[234,1.40],"FDUS00":[717,1.68],"FDUS01":[752,1.15],"FEMA00":[606,2.27],"FEMA01":[415,1.60],"FEMA02":[127,2.95],"FEMA04":[11,0.88],"FEMA05":[10,0.38],"FENE00":[344,1.75],"FENE01":[335,1.37],"FESA00":[191,0.72],"FESA01":[182,1.27],"FEUL00":[150,1.40],"FEUL01":[149,0.47],"FILI00":[195,2.01],"FILI01":[193,1.40],"FLCE00":[1038,0.91],"FLCE01":[1054,1.69],"FLOR00":[743,0.42],"FLOR01":[745,1.66],"FLRI00":[951,1.20],"FLRI01":[865,0.95],"FNEX00":[2,0.89],"FOAN00":[59,0.40],"FOAN01":[59,2.39],"FOLN00":[442,1.07],"FOLN01":[443,1.92],"FONT00":[1304,2.28],"FONT01":[1296,0.65],"FORU00":[1723,2.51],"FORU01":[1698,0.93],"FOSA00":[274,1.11],"FOSA01":[493,1.89],"FOSA02":[232,2.26],"FOUR00":[1235,0.76],"FOUR01":[1245,2.16],"FRAN00":[1430,0.85],"FRAN01":[1422,1.81],"FRCE02":[1102,1.06],"FRCE03":[1098,0.31],"FRDI00":[222,2.25],"FRDI01":[250,1.22],"FREM00":[254,0.99],"FRET00":[463,1.08],"FRET01":[470,0.97],"FRON00":[1735,0.75],"FRON01":[1714,2.53],"FRRE00":[1276,1.31],"FRRE01":[1478,0.84],"FRRE02":[658,1.27],"FRRE03":[460,0.80],"FTAI00":[344,1.63],"FTAI01":[336,1.18],"GACH00":[239,0.86],"GAEV00":[1092,1.45],"GAIU00":[393,1.67],"GAIU01":[395,0.43],"GAME00":[486,1.51],"GAME01":[512,1.24],"GAUT00":[946,1.93],"GAUT01":[970,0.20],"GAVA00":[730,1.12],"GAVA01":[722,1.08],"GCAN00":[1755,1.30],"GCAN01":[1752,0.84],"GCHN02":[575,1.23],"GCHN03":[573,0.53],"GCLB00":[450,2.92],"GCLB01":[440,1.07],"GCMP00":[1303,2.38],"GCMP01":[1293,1.09],"GDHA00":[1417,0.77],"GDHA01":[1441,1.41],"GDLA00":[2051,1.54],"GDLA01":[2044,0.84],"GDON00":[193,2.86],"GDON01":[193,0.51],"GEBE00":[241,1.57],"GEBE01":[234,1.31],"GENT00":[1038,0.84],"GENT01":[1054,1.80],"GETE00":[1820,1.52],"GETE01":[1813,0.66],"GFAQ00":[1755,1.09],"GFAQ01":[1753,1.18],"GGNY00":[76,1.26],"GGNY01":[71,1.71],"GIAC00":[1034,0.83],"GIOL00":[2071,1.42],"GLAI00":[1196,1.63],"GLAI01":[1163,1.20],"GLOU00":[570,1.13],"GLOU01":[569,0.58],"GMAR01":[1,4.40],"GOS00":[1039,1.03],"GOS01":[1038,0.48],"GOUL00":[2643,0.71],"GPRE00":[1767,0.45],"GPRE01":[1519,2.24],"GPRE02":[1197,1.92],"GRAV00":[393,1.36],"GRAV01":[396,0.56],"GRCA00":[274,1.22],"GRCA01":[260,1.05],"GRDL00":[463,2.19],"GRDL01":[1242,0.79],"GRDL02":[1250,2.28],"GRDL03":[495,1.59],"GRES00":[528,0.95],"GRES01":[509,1.15],"GROT00":[850,0.69],"GROT01":[864,0.84],"GRVI00":[5,3.12],"GRVI01":[1242,1.87],"GRVI02":[1159,1.83],"GRVI03":[519,1.24],"GRVI04":[495,1.52],"GRVI06":[264,0.59],"GSAC00":[1784,1.97],"GSAC01":[1752,1.38],"GSDN02":[516,1.45],"GSDN03":[505,2.55],"GSMA00":[193,1.52],"GSMA01":[181,0.48],"GSON00":[1894,1.43],"GSON01":[1878,0.68],"GSON02":[2,6.03],"GTVI00":[245,1.48],"GTVI01":[234,1.25],"GUYE00":[2027,1.77],"GUYE01":[2025,0.70],"GVRI00":[265,2.08],"GVRI01":[266,0.92],"GXPO00":[183,4.00],"GXPO01":[173,2.13],"GXTU00":[179,4.10],"GXTU01":[166,2.23],"GXZC00":[178,4.43],"GXZC01":[152,1.93],"GYEG00":[475,1.36],"GYPO01":[254,1.73],"GZIM00":[689,1.75],"GZIM01":[667,1.23],"HACH00":[262,0.79],"HAMA00":[134,0.90],"HAMA01":[135,1.36],"HBOR00":[468,1.15],"HERM00":[788,0.86],"HOFL01":[0,0.00],"HOPI00":[1053,1.20],"HOPI01":[980,2.11],"HOPI03":[950,1.17],"HTAI00":[159,2.07],"HTAI01":[157,0.75],"HTCH00":[262,0.64],"HTCH01":[265,0.81],"HTIN00":[393,2.01],"HTIN01":[373,1.59],"HTOU00":[591,1.90],"HTOU01":[589,0.27],"HTOU03":[654,1.10],"HTOU04":[677,1.88],"ICC00,":[417,0.81],"ICC01,":[439,1.43],"INDE00":[1235,0.81],"INDE01":[1245,2.05],"INDT00":[1101,0.73],"INDT01":[1101,0.51],"INTR00":[935,2.61],"INTR01":[920,0.67],"ISAM00":[642,2.79],"ISAM01":[641,1.60],"ISAM02":[2075,0.71],"JADA00":[665,0.90],"JADA01":[602,1.64],"JAGI00":[511,2.24],"JAGI01":[504,1.73],"JALP00":[1794,3.40],"JALP01":[1790,0.67],"JALP04":[487,1.87],"JALP05":[514,0.94],"JALP06":[4,0.00],"JARB00":[971,0.56],"JARB01":[1974,1.36],"JARB02":[1025,0.61],"JBRT00":[578,1.21],"JBRT01":[577,0.58],"JEUN00":[922,2.02],"JEUN01":[916,1.07],"JJAC00":[1286,2.00],"JJAC01":[1294,1.14],"JLIM02":[394,1.25],"JMEL00":[263,0.51],"JMEL01":[266,1.00],"JMON00":[159,2.03],"JMON01":[162,1.22],"JOCT00":[2700,1.79],"JOCT01":[2652,1.39],"JOCT02":[260,0.70],"JOCT03":[484,12.36],"JOCT07":[1244,0.44],"JOCT08":[1243,2.45],"JPSA00":[1730,1.42],"JPSA01":[1728,0.71],"JPTH00":[1101,0.72],"JPTH01":[1100,0.54],"JUCH00":[274,1.53],"JUCH01":[260,1.28],"JUMR00":[125,1.98],"JUMR01":[406,0.92],"JUPL00":[273,1.24],"JUPL01":[260,1.65],"JURA01":[2,11.18],"JVIL00":[743,0.55],"JVIL01":[743,1.85],"JVUY00":[195,1.85],"JVUY01":[193,1.21],"KRIG00":[865,1.20],"KRIG01":[873,0.85],"LABL00":[244,1.96],"LABL01":[248,0.72],"LACH00":[234,1.45],"LACH01":[254,1.91],"LACO00":[270,1.71],"LACO01":[277,1.59],"LADA00":[368,1.55],"LADA01":[324,1.35],"LADA02":[26,1.26],"LADO00":[98,1.72],"LADO01":[92,1.26],"LAFA01":[1,2.55],"LAMA00":[1365,0.97],"LAMA01":[1364,0.93],"LAPR04":[573,1.50],"LAPR05":[573,1.14],"LARG00":[649,0.82],"LARG01":[677,2.08],"LAUB00":[865,1.35],"LAUB01":[871,0.69],"LAUB02":[573,2.00],"LAUB03":[573,1.05],"LBRU00":[849,1.41],"LBRU01":[870,0.80],"LBUR00":[265,1.89],"LBUR01":[266,0.65],"LCHE00":[249,0.61],"LCHE01":[253,0.85],"LCRE00":[230,2.57],"LCRE01":[224,1.08],"LCTE00":[76,1.18],"LCTE01":[71,1.89],"LERO00":[904,1.65],"LERO01":[910,0.87],"LFOR00":[464,2.26],"LFOR01":[494,1.43],"LFRG00":[274,1.12],"LFRG01":[261,1.45],"LHCY00":[184,3.31],"LHCY99":[173,2.56],"LIBE00":[204,1.55],"LIBE01":[204,1.08],"LIBR01":[1,3.55],"LMLD00":[677,1.93],"LMLD01":[653,0.98],"LOCH00":[721,1.47],"LOCH01":[443,1.72],"LOCH02":[753,1.42],"LOCH03":[442,1.02],"LOEX00":[530,1.83],"LOLA00":[267,1.93],"LOMB00":[981,1.61],"LOUR00":[273,1.05],"LOUR01":[260,1.76],"LOVR00":[232,1.07],"LOVR01":[234,1.59],"LQUI00":[664,1.43],"LQUI01":[664,0.98],"LTOU01":[1,3.67],"LUGE00":[281,2.03],"LUGE01":[272,0.81],"LULY00":[228,1.77],"LULY04":[657,1.27],"LVAL00":[272,1.34],"LVAL01":[262,1.58],"LYIN00":[269,1.41],"LYON00":[2838,0.49],"LYON01":[2841,2.24],"LYON02":[2,4.36],"LYON03":[2673,0.73],"MACH00":[344,1.69],"MACH01":[336,1.24],"MACH02":[374,0.92],"MAGE00":[68,1.06],"MAIX00":[750,1.61],"MAIX01":[749,0.71],"MALA00":[42,3.42],"MALA01":[1037,0.95],"MALA02":[1055,1.63],"MANC00":[368,1.82],"MANC01":[291,1.13],"MANU00":[441,1.61],"MANU01":[442,1.22],"MAON00":[1231,0.65],"MARB00":[1245,2.48],"MARB01":[1244,0.87],"MARG00":[393,1.41],"MARG01":[393,0.49],"MASS00":[190,0.64],"MASS01":[182,1.01],"MATG00":[130,0.52],"MATG01":[132,1.75],"MATH00":[273,0.86],"MATH01":[260,1.82],"MAZE00":[232,1.11],"MAZE01":[234,1.65],"MCON00":[191,2.78],"MCON01":[164,2.20],"MDRZ00":[221,2.67],"MDRZ01":[220,0.90],"MECO00":[27,1.26],"MEGL00":[234,1.88],"MEGL01":[227,0.96],"MEMA00":[519,1.07],"MEMA01":[491,1.69],"MEPR00":[229,1.73],"MEPR01":[227,1.15],"MERV00":[1068,1.03],"MERV01":[475,2.76],"METR00":[5281,0.91],"MGNE00":[1466,0.92],"MGNE01":[1479,2.11],"MGRE00":[698,1.02],"MGRE01":[686,1.66],"MIDE00":[262,1.57],"MIDE01":[529,1.11],"MIDE02":[263,0.71],"MIES00":[5,1.38],"MILE00":[1285,2.04],"MILE01":[2019,1.64],"MILT01":[1,3.27],"MINE00":[949,1.39],"MIRE00":[1039,1.08],"MIRE01":[1037,0.50],"MLBA00":[1038,0.38],"MLBA01":[1040,2.30],"MLER00":[193,2.98],"MLER01":[194,0.30],"MLGN00":[245,1.43],"MLGN01":[234,1.26],"MLIN00":[98,1.97],"MLIN01":[93,1.25],"MLPT00":[284,0.94],"MLPT01":[273,0.47],"MLRD00":[3136,1.62],"MLRD01":[12,0.54],"MLRD03":[4846,1.18],"MLRD04":[1771,0.91],"MLVT00":[161,2.14],"MLVT01":[154,1.17],"MNEU00":[307,1.50],"MNEU01":[291,2.10],"MNEU02":[61,1.54],"MNEU03":[60,0.89],"MNEU98":[291,0.95],"MNEU99":[307,2.37],"MOIL01":[1796,0.94],"MOIL02":[1463,1.02],"MOIL04":[2,5.78],"MOLE00":[1103,1.14],"MOLE01":[1097,0.26],"MOLL00":[270,1.93],"MOLL01":[277,1.32],"MONN00":[246,1.38],"MORL00":[1587,1.80],"MORL01":[655,1.80],"MORL02":[917,1.07],"MOTU00":[946,1.56],"MOTU01":[970,0.36],"MOUI00":[426,1.43],"MOUI01":[425,1.68],"MOVE00":[264,1.69],"MPAR00":[1035,0.70],"MPAR01":[1039,2.16],"MRCH00":[1722,1.02],"MRCH01":[1726,1.31],"MRCH02":[1303,2.16],"MRGI01":[1,0.00],"MRLG00":[233,1.52],"MRLG01":[252,1.61],"MRNE00":[1303,2.26],"MRTI00":[336,1.15],"MRTI01":[342,1.08],"MSIL00":[193,2.70],"MSIL01":[192,0.43],"MSNT00":[270,1.45],"MSNT01":[277,1.86],"MSQU00":[263,1.57],"MSQU01":[266,0.97],"MSSE00":[255,1.00],"MSSE01":[249,0.70],"MTBL00":[2150,1.10],"MTBL01":[2146,0.59],"MTCH00":[1737,0.26],"MTCH01":[1715,3.10],"MTER00":[274,0.70],"MTER01":[281,2.19],"MTFL00":[249,1.67],"MTFL01":[244,0.90],"MTFL02":[5,0.54],"MTOU00":[234,1.82],"MTOU01":[227,1.02],"MTTA00":[2052,0.24],"MTTA01":[2057,1.33],"MUET01":[1236,2.17],"MUET02":[1244,0.51],"MUGE00":[193,2.96],"MUGE01":[193,0.59],"MURA00":[27,1.02],"MUSE00":[2890,1.06],"MUSE01":[1053,1.97],"MUVO00":[646,0.48],"MUVO01":[651,1.98],"MVER00":[271,1.21],"MVER01":[277,1.11],"MYRN00":[592,1.87],"MYRN01":[587,0.38],"MYRN02":[495,1.75],"MYRN03":[515,1.23],"NAIS00":[393,1.39],"NAIS01":[393,0.41],"NAMA00":[149,1.40],"NAMA01":[149,0.31],"NANT00":[348,1.92],"NANT01":[336,1.10],"NATI01":[1508,0.78],"NATI02":[692,0.75],"NATI10":[1048,2.38],"NATI11":[1049,0.91],"NATI12":[1029,1.27],"NATI13":[726,0.93],"NATI14":[687,2.44],"NATI15":[699,1.37],"NATI16":[951,1.83],"NATI18":[303,0.76],"NATI19":[861,0.84],"NATI20":[850,0.62],"NAVI00":[946,1.83],"NAVI01":[970,0.26],"NDAM00":[9,5.21],"NGAR00":[2,0.00],"NOIR00":[54,1.64],"OCHT00":[51,2.28],"OCHT01":[51,1.56],"OMS00,":[359,0.65],"ONCI00":[2129,1.72],"ONEX00":[2019,1.55],"ONEX01":[2037,0.82],"ONEX02":[576,1.15],"ONEX03":[573,0.60],"ONMA00":[1819,2.34],"ONMA01":[1813,0.78],"ORMA00":[642,2.68],"ORMA01":[642,1.44],"OUCH00":[1972,1.31],"OUCH01":[1959,1.51],"OULA00":[273,0.69],"OULA01":[281,2.18],"OXFR00":[192,2.71],"OXFR01":[163,2.22],"PAAN00":[264,1.36],"PAGN00":[152,1.80],"PAGN01":[161,1.65],"PAIL00":[743,0.54],"PAIL01":[1142,1.58],"PALE00":[36,0.43],"PALE01":[2177,1.04],"PALE02":[1294,0.92],"PALE04":[2,1.48],"PALE05":[953,2.27],"PALE06":[1905,1.19],"PALL00":[66,0.90],"PALL01":[66,2.04],"PARC00":[1297,0.40],"PARC01":[1293,2.29],"PASS00":[271,1.47],"PASS01":[277,0.69],"PBAL00":[1234,0.69],"PBAL01":[254,0.68],"PBAL02":[249,0.96],"PBAL03":[1244,2.14],"PBRU00":[134,1.11],"PBRU01":[135,1.04],"PCEA00":[253,1.32],"PCEA01":[244,1.13],"PCHA00":[1040,0.93],"PCHA01":[2014,1.01],"PDRI00":[230,2.39],"PDRI01":[223,0.85],"PEDO00":[753,1.84],"PEDO01":[716,1.39],"PEIL00":[1620,1.48],"PEIL01":[1616,0.41],"PEIL02":[254,0.56],"PEIL03":[250,1.90],"PEMA00":[443,1.84],"PEMA02":[442,1.00],"PENT00":[343,1.61],"PENT01":[335,1.42],"PESC00":[1039,0.95],"PESC01":[1035,0.38],"PESC02":[980,1.19],"PETR00":[368,1.76],"PETR01":[290,1.16],"PEUP00":[123,2.12],"PEUP01":[123,0.47],"PEVD00":[999,1.13],"PEVI00":[443,1.75],"PEVI03":[442,0.99],"PFLE00":[848,1.43],"PFLE01":[871,0.83],"PFON00":[515,1.75],"PFON01":[493,1.01],"PFUM00":[607,1.52],"PGRA00":[269,2.06],"PGRA01":[277,0.63],"PHIL00":[951,1.23],"PIBO00":[272,1.27],"PIBO01":[262,1.75],"PIBO02":[4,0.00],"PICY00":[2054,1.54],"PICY01":[1993,0.83],"PINC00":[195,2.12],"PINC01":[193,1.41],"PJAR00":[149,1.19],"PJAR01":[149,0.66],"PLAI00":[177,1.76],"PLAI01":[168,1.60],"PLDI00":[1970,1.39],"PLDI01":[1930,1.07],"PLEC00":[97,2.65],"PLEC01":[92,0.75],"PLEV00":[5293,1.41],"PLEV01":[661,2.30],"PLEV02":[1297,1.76],"PLEV04":[463,2.68],"PLEY00":[1042,1.02],"PLEY01":[978,0.71],"PLGE00":[2588,1.24],"PLGE01":[702,0.99],"PLGE02":[0,0.00],"PLGE03":[685,2.03],"PLIO00":[158,2.03],"PLIO01":[152,1.14],"PLLT00":[368,1.45],"PLLT01":[290,1.35],"PLLT03":[60,0.41],"PLNT00":[177,1.49],"PLNT01":[177,0.77],"PLOU00":[755,1.43],"PLOU01":[721,1.66],"PLPA00":[1932,1.12],"PLPA01":[2,3.28],"PLPA02":[1880,1.30],"PLPA03":[1103,0.78],"PLPA04":[951,1.25],"PLPA07":[1153,0.49],"PLRT00":[269,1.06],"PLTA00":[244,2.30],"PLTA01":[245,0.97],"PLUL00":[443,1.69],"PLUL01":[442,1.06],"PMAR00":[498,0.68],"PMEY00":[570,1.69],"PMEY01":[572,1.31],"PMIO00":[478,1.58],"PMIO01":[480,1.19],"PMOR01":[1,3.57],"PNEV00":[1040,1.31],"PNEV01":[978,0.58],"PNEV02":[1925,0.99],"PNEV03":[1870,1.17],"POCH00":[254,1.29],"POCH01":[244,1.11],"POGA00":[114,1.10],"POLT00":[152,1.07],"POLT01":[161,1.44],"POMI00":[1593,1.82],"POMI01":[1573,1.44],"PONT00":[931,1.93],"PONT01":[1182,0.72],"PONT02":[919,1.42],"PONT03":[1181,1.24],"PORT00":[2138,1.19],"POST00":[1732,2.46],"POST01":[1051,0.77],"POTE00":[2837,0.60],"POTE01":[2842,1.88],"POUS00":[282,0.79],"POUS01":[275,1.69],"PPAL00":[393,1.55],"PPAL01":[393,0.43],"PPIN00":[229,2.72],"PPIN01":[223,0.73],"PPLA00":[187,2.35],"PPLA01":[167,2.43],"PPLA02":[4,8.88],"PPOL00":[499,1.19],"PPOL01":[508,1.74],"PR4700":[657,1.95],"PR4701":[655,1.37],"PRBE01":[1370,1.23],"PRBE02":[1055,1.23],"PRBE03":[1645,1.31],"PRBE04":[1645,1.67],"PREL00":[177,1.31],"PREL01":[176,1.04],"PREV00":[134,0.92],"PREV01":[135,1.53],"PRGM00":[655,1.45],"PRGM01":[677,0.90],"PRGR00":[308,1.09],"PRGR01":[303,1.92],"PRLA00":[245,1.47],"PRLA01":[234,1.19],"PRMO00":[951,1.56],"PRMO01":[942,1.08],"PRPE00":[393,2.13],"PRPE01":[715,1.29],"PRPE02":[53,10.21],"PRRI00":[2672,1.49],"PRRI01":[2676,1.08],"PRSM00":[1015,1.34],"PRSM01":[1050,1.81],"PRSM02":[1037,0.93],"PRTN00":[65,1.35],"PRTN01":[65,1.08],"PRUL00":[494,1.60],"PRUL01":[519,1.28],"PRVG00":[51,2.76],"PRVG01":[51,1.69],"PRVG02":[257,0.92],"PSAC00":[1038,0.52],"PSAC01":[1040,2.24],"PSGE00":[274,1.40],"PSGE01":[260,0.91],"PSIE00":[1097,1.35],"PSIE01":[1107,0.91],"PSRY00":[270,1.91],"PSRY01":[277,0.50],"PSSY00":[68,0.88],"PSTA00":[234,0.92],"PSTA01":[232,2.07],"PSUD00":[275,1.28],"PSUD01":[262,1.56],"PTAR00":[1918,1.06],"PTAR01":[1931,1.43],"PTAR02":[981,1.63],"PTLA00":[2329,1.29],"PTLA01":[1213,0.37],"PTLA02":[1128,1.33],"PTOU00":[528,0.96],"PTOU01":[509,0.97],"PTPE00":[44,0.66],"PTPE01":[274,1.09],"PUMA00":[509,0.97],"PUMA01":[274,1.18],"PVEY00":[664,1.43],"PVEY01":[664,1.00],"PVEY02":[387,2.19],"PVRT00":[193,2.46],"PVRT01":[192,0.46],"PXPO00":[931,2.30],"PXPO01":[920,0.86],"PXPO04":[469,1.49],"PYMA00":[343,1.40],"PYMA01":[336,1.41],"PYVI00":[343,1.45],"PYVI01":[336,1.43],"QARV00":[730,1.25],"QARV01":[722,0.76],"QUID00":[1218,2.19],"QUID01":[1213,0.41],"QUOA00":[277,0.81],"RANN00":[227,3.31],"RANN01":[221,0.79],"RAVI00":[753,1.69],"RAVI01":[721,1.43],"RCOR00":[234,1.76],"RCOR01":[226,1.04],"RCOR02":[27,1.35],"RCPS00":[27,1.73],"RDAY00":[221,3.72],"RDAY01":[220,0.60],"REFT00":[270,2.17],"REFT01":[277,0.47],"RENF00":[960,1.54],"RENF02":[1435,1.24],"RENF03":[454,0.96],"REPE00":[368,1.41],"REPE01":[350,1.73],"REVE00":[980,1.78],"RIAN00":[386,1.50],"RIEU00":[1037,1.03],"RIEU01":[1054,1.63],"RIGO00":[1025,0.62],"RIGO01":[1028,1.33],"RIPP00":[222,1.89],"RIPP01":[251,1.15],"RIVE00":[1771,1.24],"RIVE01":[434,0.56],"RIVE02":[674,1.38],"RIVE03":[698,0.95],"RIVE04":[1498,2.05],"RIVE05":[306,0.34],"RIVE06":[3688,1.43],"RIVE08":[1771,1.04],"RIVE09":[864,1.04],"RIVE10":[873,1.30],"RIVE11":[746,1.05],"RLAC00":[1975,0.65],"RLAC01":[1296,2.18],"RLUL00":[273,1.35],"RLUL01":[261,0.94],"RMOU00":[729,1.34],"RMOU01":[722,1.07],"ROCH00":[1777,1.39],"ROCH01":[1773,1.04],"ROSE00":[980,2.05],"ROUE00":[221,2.13],"ROUE01":[251,1.03],"ROUE02":[4,1.79],"ROUE03":[14,0.53],"ROUS00":[864,0.75],"ROUS01":[475,2.68],"RPOS00":[428,1.23],"RPOS01":[445,1.27],"RPRS00":[274,1.31],"RPRS01":[262,1.04],"RSMA00":[393,1.74],"RSMA01":[396,0.39],"RTEP00":[336,2.00],"RTEP01":[342,0.72],"RTTE00":[263,1.15],"RTTE01":[267,1.20],"RUSS00":[83,1.06],"RUSS01":[13,0.53],"RUTH00":[700,1.04],"RUTH01":[686,1.75],"RVTT00":[229,2.44],"RVTT01":[223,0.78],"SACO00":[432,1.60],"SACO01":[440,0.85],"SAGY00":[241,1.26],"SAGY01":[234,1.45],"SALV00":[249,0.68],"SALV01":[254,0.87],"SARV00":[149,1.19],"SARV01":[149,0.64],"SAUS00":[230,2.41],"SAUS01":[223,0.88],"SCEC00":[519,1.04],"SCEC01":[493,1.65],"SCHA00":[178,1.99],"SCHA01":[176,0.47],"SCLO00":[1241,2.06],"SCLO01":[1244,0.48],"SECH00":[970,0.32],"SECH01":[949,1.40],"SELI00":[204,0.82],"SELI01":[204,1.54],"SENV00":[546,1.27],"SERV00":[2838,0.77],"SERV01":[2843,2.22],"SERV02":[730,0.94],"SERV03":[722,1.21],"SEUJ00":[727,1.87],"SEUJ01":[722,1.00],"SEVI00":[228,3.13],"SEVI01":[506,1.58],"SEYM00":[1232,0.62],"SEYM01":[1245,2.34],"SEYM02":[234,1.64],"SEYM03":[232,1.12],"SEZG00":[270,1.82],"SEZG01":[277,0.76],"SGBO00":[154,1.92],"SGBO01":[161,1.32],"SGGA00":[157,1.99],"SGGA01":[161,0.92],"SGNY00":[192,2.97],"SGNY01":[174,2.01],"SHUM00":[161,1.70],"SHUM01":[157,1.41],"SIER00":[1097,1.36],"SIER01":[1109,1.01],"SIGL00":[832,0.59],"SIGL01":[824,1.87],"SIGN00":[658,1.78],"SIGN01":[677,0.54],"SILO00":[276,1.29],"SILO01":[262,1.53],"SIMO00":[1102,1.04],"SIMO01":[1098,0.45],"SION00":[274,1.13],"SION01":[260,1.25],"SISM00":[234,1.57],"SISM01":[232,1.14],"SJCE00":[459,1.84],"SJCE01":[437,1.80],"SJGA00":[469,1.79],"SJGA01":[456,1.58],"SJHO00":[66,2.01],"SJHO01":[66,1.11],"SLOU00":[255,0.72],"SLOU01":[249,0.82],"SLSI00":[427,1.95],"SLSI01":[425,1.00],"SLSI02":[422,1.32],"SLSI03":[434,1.07],"SMAU00":[26,1.30],"SOCI00":[1288,2.59],"SOCI01":[1293,1.16],"SOLE00":[368,1.38],"SOLE01":[351,2.06],"SRMA00":[270,2.14],"SRMA01":[277,1.42],"SRVI00":[270,1.71],"SRVI01":[277,1.82],"SSCH00":[393,1.33],"SSCH01":[396,0.57],"STAL00":[925,0.58],"STAL01":[1155,1.29],"STAL03":[140,0.97],"STGE00":[1669,1.00],"STGE01":[1495,1.87],"STGE03":[1292,1.94],"STGE04":[520,1.65],"STLA00":[270,1.33],"STLA01":[277,2.00],"STND00":[2076,0.61],"STND01":[1930,1.38],"STND02":[2052,0.99],"STND03":[1968,1.58],"STND04":[645,0.95],"STRC00":[254,0.71],"STRC01":[253,2.01],"SUMO00":[270,1.72],"SUMO01":[277,1.33],"SUSE00":[657,1.84],"SUSE01":[655,1.42],"SVEY00":[192,1.40],"SVEY01":[431,1.42],"SVEY02":[445,1.80],"SVEY03":[193,0.62],"SVIL00":[233,0.75],"SVIL01":[232,1.80],"SVON00":[394,1.83],"SVON01":[396,0.44],"SYEG00":[67,1.19],"SYGA00":[358,1.15],"SYGA01":[348,0.78],"SYMA00":[67,1.18],"SYPO00":[68,0.87],"SYPO01":[67,0.59],"TABO00":[67,1.12],"TANN00":[2,1.40],"TANN01":[3,1.19],"TCAR00":[1744,1.53],"TCAR01":[1711,1.59],"TCAR02":[968,2.58],"TCAR03":[1295,1.10],"TCRE00":[700,0.99],"TCRE01":[686,1.75],"TGIN02":[191,3.89],"TGIN03":[173,2.36],"THGA00":[151,2.55],"THGA01":[156,1.14],"THMA00":[149,2.14],"THMA01":[155,1.41],"THMA02":[6,1.61],"THMA03":[5,0.30],"THRE00":[1616,1.75],"THRE01":[1506,0.82],"TILL00":[79,1.55],"TILL01":[79,1.90],"TLIG00":[2548,1.70],"TLIG01":[862,1.70],"TOCO00":[2157,0.74],"TOCO01":[2176,1.38],"TOU01,":[29,0.49],"TOUR00":[1037,0.50],"TOUR01":[1041,2.35],"TOUV00":[65,1.31],"TOUV01":[65,1.25],"TRAN00":[1816,1.09],"TRBL00":[1183,0.77],"TRBL01":[1181,1.19],"TREU00":[22,0.89],"TREU01":[51,0.67],"TRIZ00":[393,1.20],"TRIZ01":[395,0.85],"TRLL00":[843,1.43],"TRLL01":[841,0.58],"TRMB00":[1513,1.06],"TRMB01":[1519,1.93],"TRSI00":[1769,1.45],"TRSI01":[1770,0.92],"TRSI02":[2002,1.57],"TRSI03":[2017,0.90],"TRTI00":[464,1.49],"TRTI01":[308,0.76],"TRTI02":[516,1.91],"TRTI03":[346,2.03],"TUIL00":[270,1.95],"TUIL01":[277,0.66],"TURA00":[234,1.59],"TVDO00":[1642,1.18],"TVER00":[191,0.79],"TVER01":[182,1.08],"TXMA00":[231,2.56],"TXMA01":[224,0.70],"TXVI00":[231,2.36],"TXVI01":[226,0.74],"UBER00":[575,1.35],"UBER01":[573,0.50],"UIT00,":[054,0.83],"UIT01,":[057,1.14],"UNIM01":[1101,0.75],"UNIM02":[1102,0.63],"VALY00":[780,1.85],"VALY01":[767,0.70],"VAND00":[255,0.73],"VAND01":[244,2.05],"VAND02":[8,1.67],"VARV00":[1303,2.10],"VARV01":[1295,0.68],"VATH00":[134,2.63],"VATH01":[160,1.28],"VAUD00":[1204,3.21],"VAUD01":[1202,0.58],"VDUR00":[575,1.25],"VDUR01":[573,0.54],"VEEC00":[1581,1.54],"VEEC01":[1583,1.08],"VEGY00":[89,1.70],"VELO00":[754,1.55],"VELO01":[720,1.39],"VEMA00":[1581,1.94],"VEMA01":[1584,0.73],"VERB00":[149,1.25],"VERB01":[149,0.59],"VERN00":[519,1.28],"VERN01":[495,1.54],"VESY00":[196,2.38],"VESY01":[193,1.27],"VEUS00":[204,1.20],"VEUS01":[204,1.03],"VEVI00":[1585,0.74],"VEVI01":[1278,1.79],"VEVI02":[302,1.83],"VGEC00":[51,2.59],"VGEC01":[51,1.32],"VICH00":[653,1.47],"VICH01":[655,1.70],"VIDO00":[1049,2.42],"VIDO01":[1051,0.94],"VIDO02":[846,0.71],"VIDO03":[864,0.88],"VILL00":[1770,1.49],"VILL01":[1767,0.82],"VIMO00":[66,0.99],"VIMO01":[66,1.67],"VIPA00":[136,1.87],"VIRY00":[76,1.17],"VIRY01":[71,1.61],"VIUS00":[1797,0.54],"VIUS01":[1798,2.05],"VLAI00":[687,1.18],"VLAI01":[685,2.81],"VLLA00":[393,1.24],"VLLA01":[395,0.65],"VLON00":[1309,1.96],"VLON01":[1057,1.13],"VLON02":[234,1.12],"VLRS00":[865,1.52],"VLRS01":[871,0.56],"VOIR00":[904,0.88],"VOIR01":[904,1.67],"VOIT00":[487,1.69],"VOIT01":[513,1.15],"VOLL00":[1978,0.65],"VOLL01":[1294,2.47],"VOLL02":[694,1.79],"VRAS00":[419,1.42],"VRAS01":[434,0.94],"VRBE00":[1049,1.72],"VRBE01":[690,0.57],"VRBE02":[688,3.17],"VRDO00":[864,1.20],"VREC00":[210,0.93],"VREC01":[436,1.52],"VREC02":[232,1.98],"VRLP00":[177,1.38],"VRLP01":[177,0.59],"VRMT00":[1049,2.00],"VRMT01":[1525,0.89],"VRNT00":[730,0.99],"VRNT01":[722,1.19],"VROT00":[677,1.85],"VROT01":[650,0.92],"VRTC00":[184,4.06],"VRTC01":[174,2.03],"VSEG00":[118,0.58],"VSNA00":[702,1.67],"VSNA01":[688,1.83],"VSNA02":[59,0.75],"VTRN00":[194,2.58],"VTRN01":[194,0.91],"VTRN02":[863,0.86],"VTRN03":[464,1.47],"VTTE00":[865,1.22],"VTTE01":[876,0.89],"VUAT00":[149,1.41],"VUAT01":[149,0.25],"VUIL00":[1645,1.28],"VUIL01":[1648,1.56],"VVRA00":[239,1.24],"VVRA01":[231,1.40],"VXBO00":[255,1.49],"VXBO01":[244,1.20],"VXGA00":[255,1.40],"VXGA01":[244,1.20],"VXVV00":[238,1.35],"VXVV01":[234,1.35],"VXVV02":[4,0.68],"VYCL00":[146,1.24],"VYFO00":[76,1.31],"VYFO01":[71,2.23],"WEBR00":[1038,0.97],"WEBR01":[1054,1.70],"WEND00":[730,1.10],"WEND01":[722,0.68],"WTC00":[2155,1.01],"WTC01":[2175,1.41],"ZIPL02":[841,1.19],"ZMOU00":[131,1.12]}



		// d3 geo
		var projection = d3.geo.mercator()
			.center(lonlat)  
			.scale(1700000)
			.translate([width/2, height/2]);
		var path = d3.geo.path()
			.projection(projection);
		var colorScale = ["#EAF5DA","#CFE8AC","#9FC961","#7CAD34","#64961B","#41660A"];
		var colorScaleDelay = d3.scale.linear()
			.domain([0, 5])
			.range(['#ED3A2D', '#2e0101']);
		var sizeScaleFrequency = d3.scale.linear()
			.domain([1,10000])
			.range([1,40]);
		var routeID = function(d,i) {
			return "route-" + d.properties.routeCode;
		};
		var routeName = function(d,i) {
			return d.properties.routeCode;
		};
		var stopR = function(d, i) {
			var delay = stopsData[d.properties.stopCode];
			if (delay) {
				return sizeScaleFrequency(delay[0]);
			};
		};
		var fillDelay = function(d,i) {
			var delay = stopsData[d.properties.stopCode];
			if (delay) {
			    return colorScaleDelay(delay[1]);
			};
		};
		var zoom = d3.behavior.zoom()
			.translate(projection.translate())
			.scale(projection.scale())
			.scaleExtent([1200000,4000000])
			.on("zoom", function() {
				projection.translate(d3.event.translate).scale(d3.event.scale);
				group.selectAll("path").attr("d", path);
				group.selectAll("circle.stop").attr("cx", function(d) {
				    return projection(d.geometry.coordinates)[0] 
				});
				group.selectAll("circle.stop").attr("cy", function(d) {
				    return projection(d.geometry.coordinates)[1] 
				});
		});



		// initialize viz
		var group = d3.select("#viz").append("svg").attr("width",width).attr("height",height);
		group.call(zoom);



		// functions to draw routes and stops
		var routes = function() {
			d3.json('_js/geneva-routes.json', function(data) {
				group.selectAll("path.route")
					.data(data.features)
					.enter()
					.append("path")
					.attr("d", path)
					.style("fill", "none")
					.attr("class", "route")
					.attr("id", routeID)
					.attr("title", routeName);
				loader.run();
			});
		};
		var stops = function() {
			d3.json('_js/geneva-stops.json', function(data) {
				group.selectAll("circle.stop")
					.data(data.features)
					.enter()
					.append("circle")
					.classed("stop", true)
					.attr({
						r: stopR,
						cx: function(d,i) { 
							return projection(d.geometry.coordinates)[0] 
						},
						cy: function(d,i) { 
							return projection(d.geometry.coordinates)[1] 
						},
						"fill": fillDelay,
						"stopid": function(d,i) { 
							return d.properties.stopCode
						},
						"intersection": function(d,i) { 
							return (d.properties.stopName)
						},
						"delay": function(d,i) { 
							var delay = stopsData[d.properties.stopCode];
							if (delay) {
							    if (delay[1] < 0)	{
							    	return 0;
							    } else if (delay[1] < 1) {
							    	return 1;
							    } else {
							    	return delay[1];
							    }
							} else {
							    return 0;
							};
						}
					})
					.on("mouseover", function(self) {
						self = $(this);
						self.animate({
							"stroke-width": ".5px",
							"opacity": 1
						}, 100);
						var text = "";
						if (self.attr("r") <= 1) {
							var text = "<p><strong>Stop " + self.attr("stopid") + "</strong><br/><span>" + self.attr("intersection") + "</span></p><p><strong>Average Delay</strong><br/> < 1 minute</p>";
						} else {
							var text = "<p><strong>Stop " + self.attr("stopid") + "</strong><br/><span>" + self.attr("intersection") + "</span></p><p><strong>Average Delay</strong><br/> " + self.attr("delay") + " minutes</p>";
						};
						$("#info").show().html(text);
					})
					.on("mouseout", function(self) {
						self = $(this);
						self.animate({
							"stroke-width": 0,
							"opacity": .3
						}, 100);
						$("#info").hide().html("");
					})		
				loader.run();
				$("#loading").fadeOut(1000);
			});
		};



		// queue up and run the functions
		loader.push(routes);
		loader.push(stops);
		loader.run();



		// zoom in & out buttons
	    $("#zoom-in").on("click", function() {
		    var newScale = projection.scale() + 500000;
		    projection.scale(newScale);
		    group.selectAll("path").attr("d", path);
		    group.selectAll("circle.stop").attr("cx", function(d) {
		        return projection(d.geometry.coordinates)[0] 
		    });
		    group.selectAll("circle.stop").attr("cy", function(d) {
		        return projection(d.geometry.coordinates)[1] 
		    });
		    // important! assigns the new scale to the zoom mouse behavior
		    var zoom = d3.behavior.zoom()
		       .translate(projection.translate())
		       .scale(newScale)
		       .scaleExtent([1250000,6000000])
		       .on("zoom", function() {
		       	projection.translate(d3.event.translate).scale(d3.event.scale);
		       	group.selectAll("path").attr("d", path);
		       	group.selectAll("circle.stop").attr("cx", function(d) {
		       	    return projection(d.geometry.coordinates)[0] 
		       	});
		       	group.selectAll("circle.stop").attr("cy", function(d) {
		       	    return projection(d.geometry.coordinates)[1] 
		       	});
		    });
		    group.call(zoom);
		});
	    $("#zoom-out").on("click", function() {
		    var newScale = projection.scale() - 500000;
		    projection.scale(newScale);
		    group.selectAll("path").attr("d", path);
		    group.selectAll("circle.stop").attr("cx", function(d) {
		        return projection(d.geometry.coordinates)[0] 
		    });
		    group.selectAll("circle.stop").attr("cy", function(d) {
		        return projection(d.geometry.coordinates)[1] 
		    });
		    // important! assigns the new scale to the zoom mouse behavior
		    var zoom = d3.behavior.zoom()
		       .translate(projection.translate())
		       .scale(newScale)
		       .scaleExtent([1250000,6000000])
		       .on("zoom", function() {
		       	projection.translate(d3.event.translate).scale(d3.event.scale);
		       	group.selectAll("path").attr("d", path);
		       	group.selectAll("circle.stop").attr("cx", function(d) {
		       	    return projection(d.geometry.coordinates)[0] 
		       	});
		       	group.selectAll("circle.stop").attr("cy", function(d) {
		       	    return projection(d.geometry.coordinates)[1] 
		       	});
		    });
		    group.call(zoom);
		});



    }

};



//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
var popup = {

    init : function() {

		// position popup
		windowW = $(window).width();
		$("#viz").on("mousemove", function(e) {
			var x = e.pageX + 20;
			var y = e.pageY;
			var windowH = $(window).height();
			if (y > (windowH - 100)) {
				var y = e.pageY - 100;
			} else {
				var y = e.pageY - 20;
			}

			$("#info").css({
				"left": x,
				"top": y
			});
		});

	}

};



//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
var toggles = {

    init : function() {

		$("#legend h2 a").on("click", function() {
			$(this).toggleClass("closed");
			$("#legend-detail").slideToggle(300);
			return false;
		});

		$("#toggle-tracts").on("click", function() {
			var self = $(this); 
			if (self.hasClass("active")) {
				//$("#viz .tract").fadeOut(500);
			    setTimeout(function() {
			        $("#viz .tract").each(function(i) {
			            var self = $(this); 
			            setTimeout(function() { 
			            	self.fadeOut(300);
			            }, 5 * i);
			        });
			    }, 5);   	
				self.removeClass("active");
			} else {
				//$("#viz .tract").fadeIn(500);
			    setTimeout(function() {
			        $("#viz .tract").each(function(i) {
			            var self = $(this); 
			            setTimeout(function() { 
			            	self.fadeIn(300);
			            }, 5 * i);
			        });
			    }, 5);   	
				self.addClass("active");
			}
			return false;
		});

		$(".toggle-routes").on("click", function() {
			var self = $(this); 
			var route = "#" + self.attr("id").replace("toggle-","");
			if (self.hasClass("active")) {
				$(route).css({
					"stroke-width": "2px"
				});
				$(route).animate({
					opacity: .1
				}, 100);
				self.removeClass("active");
			} else {
				$(route).css({
					"stroke-width": "5px"
				});
				$(route).animate({
					opacity: 1
				}, 100);
				self.addClass("active");
			}
			return false;
		});

		$(".toggle-routes-alt").on("click", function() {
			var self = $(this); 
			var route = "#viz ." + self.attr("id").replace("toggle-","");
			console.log(route);
			if (self.hasClass("active")) {
				$(route).css({
					"stroke-width": "2px"
				});
				$(route).animate({
					opacity: .1
				}, 100);
				self.removeClass("active");
			} else {
				$(route).css({
					"stroke-width": "5px"
				});
				$(route).animate({
					opacity: 1
				}, 100);
				self.addClass("active");
			}
			return false;
		});

	},

};



//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------
$(document).ready(function() {
	popup.init();
	toggles.init();
});
$(window).resize(function() {
	$("#viz svg").width($(window).width());
	$("#viz svg").height($(window).height());
});